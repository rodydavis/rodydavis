<!DOCTYPE html>
<html lang="en" class="astro-MDYSN4OI">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta name="generator" content="Astro v2.0.4">

<!-- Canonical URL -->
<link rel="canonical" href="https://rodydavis.com/posts/push-notifications-flutter-web/">

<!-- Primary Meta Tags -->
<title>How To Send Push Notifications on Flutter Web (FCM)</title>
<meta name="title" content="How To Send Push Notifications on Flutter Web (FCM)">
<meta name="description">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://rodydavis.com/posts/push-notifications-flutter-web/">
<meta property="og:title" content="How To Send Push Notifications on Flutter Web (FCM)">
<meta property="og:description">
<meta property="og:image" content="https://rodydavis.com/placeholder-social.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://rodydavis.com/posts/push-notifications-flutter-web/">
<meta property="twitter:title" content="How To Send Push Notifications on Flutter Web (FCM)">
<meta property="twitter:description">
<meta property="twitter:image" content="https://rodydavis.com/placeholder-social.jpg">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JQNPVBL9DR"></script>

    
  <link rel="stylesheet" href="/_astro/_...slug_.a5420181.css" />
<link rel="stylesheet" href="/_astro/_...slug_.55121d5d.css" /><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-JQNPVBL9DR");
</script></head>

  <body class="markdown-body astro-MDYSN4OI">
    <header class="astro-3EF6KSR2">
  <h2 class="astro-3EF6KSR2">
    <a href="/" class="astro-3EF6KSR2">Rody Davis</a>
  </h2>
  <nav class="astro-3EF6KSR2">
    <a href="/search?tags=app" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Apps</div>
</a><a href="/search?tags=posts" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Blog</div>
</a><a href="/talks" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Talks</div>
</a><a href="/about" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> About</div>
</a>
  </nav>
</header>
    <main class="astro-MDYSN4OI">
      <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).idle=t=>{const e=async()=>{await(await t())()};"requestIdleCallback"in window?window.requestIdleCallback(e):setTimeout(e,200)},window.dispatchEvent(new Event("astro:idle"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><main class="astro-BVZIHDZO">
    <article class="astro-BVZIHDZO">
      <!-- {
        image !== undefined && (
          <img width={720} height={360} src={image} alt="" />
        )
      } -->
      <h1 class="title astro-BVZIHDZO">How To Send Push Notifications on Flutter Web (FCM)</h1>
      <time class="astro-BVZIHDZO">May 1, 2020</time>
      
      <div class="tags astro-BVZIHDZO">
        <astro-island uid="Z13Ahbp" component-url="/_astro/TagChip.aa70bafd.js" component-export="default" renderer-url="/_astro/client.15ddb572.js" props="{&quot;tag&quot;:[0,&quot;posts&quot;],&quot;active&quot;:[0,false],&quot;onClick&quot;:[0,null],&quot;class&quot;:[0,&quot;astro-BVZIHDZO&quot;]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;TagChip&quot;,&quot;value&quot;:true}" await-children=""><div style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; background-color: var(--tag-background); color: var(--tag-color); cursor: pointer; white-space: nowrap; display: flex; flex-direction: row; align-items: center; gap: 0.25rem;">posts</div></astro-island><astro-island uid="2iAH0o" component-url="/_astro/TagChip.aa70bafd.js" component-export="default" renderer-url="/_astro/client.15ddb572.js" props="{&quot;tag&quot;:[0,&quot;flutter&quot;],&quot;active&quot;:[0,false],&quot;onClick&quot;:[0,null],&quot;class&quot;:[0,&quot;astro-BVZIHDZO&quot;]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;TagChip&quot;,&quot;value&quot;:true}" await-children=""><div style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; background-color: var(--tag-background); color: var(--tag-color); cursor: pointer; white-space: nowrap; display: flex; flex-direction: row; align-items: center; gap: 0.25rem;">flutter</div></astro-island><astro-island uid="ZdX9iC" component-url="/_astro/TagChip.aa70bafd.js" component-export="default" renderer-url="/_astro/client.15ddb572.js" props="{&quot;tag&quot;:[0,&quot;web&quot;],&quot;active&quot;:[0,false],&quot;onClick&quot;:[0,null],&quot;class&quot;:[0,&quot;astro-BVZIHDZO&quot;]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;TagChip&quot;,&quot;value&quot;:true}" await-children=""><div style="padding: 0.25rem 0.5rem; border-radius: 0.25rem; background-color: var(--tag-background); color: var(--tag-color); cursor: pointer; white-space: nowrap; display: flex; flex-direction: row; align-items: center; gap: 0.25rem;">web</div></astro-island>
      </div>
      <div class="headings astro-BVZIHDZO">
            <details class="astro-XVRFUPWN">
  <summary class="astro-XVRFUPWN">Table of Contents</summary>
  <ul class="astro-XVRFUPWN">
    <li class="astro-XVRFUPWN">
          <a href="#" class="heading-depth-2 astro-XVRFUPWN">
            Setting Up
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-1" class="heading-depth-2 astro-XVRFUPWN">
            Helper Methods
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-2" class="heading-depth-2 astro-XVRFUPWN">
            Testing
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-3" class="heading-depth-2 astro-XVRFUPWN">
            Conclusion
          </a>
        </li>
  </ul>
</details>
          </div>
      <p>If you are using Firebase then you are probably familiar with Firebase Cloud Messaging. The setup on Flutter web is very different than mobile and other plugins you are probably used to.</p>
<p><img src="/attachments/firebase_banner.webp" alt=""></p>
<h2 id=""><a aria-hidden="true" tabindex="-1" href="#"><span class="icon icon-link"></span></a>Setting Up</h2>
<p>Open your web/index.html and look for the following script. If you do not have one you can add it now in the  tag.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&#x3C;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">></span></span>
<span class="line"><span style="color: #C9D1D9">if ("serviceWorker" in navigator) </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  window.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"load"</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> () {</span></span>
<span class="line"><span style="color: #C9D1D9">    navigator.serviceWorker.</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"/flutter_service_worker.js"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #FF7B72">}</span></span>
<span class="line"><span style="color: #C9D1D9">&#x3C;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">></span></span></code></pre>
<p>We need to modify it to support the FCM service worker. The important thing we need to do is comment out the flutter_service_worker.js so that we will not get 404 errors when registering the FCM service worker.</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">&#x3C;</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">></span></span>
<span class="line"><span style="color: #C9D1D9">if ("serviceWorker" in navigator) </span><span style="color: #FF7B72">{</span></span>
<span class="line"><span style="color: #C9D1D9">  window.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"load"</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> () {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// navigator.serviceWorker.register("/flutter_service_worker.js");</span></span>
<span class="line"><span style="color: #C9D1D9">    navigator.serviceWorker.</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"/firebase-messaging-sw.js"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"><span style="color: #FF7B72">}</span></span>
<span class="line"><span style="color: #C9D1D9">&#x3C;/</span><span style="color: #7EE787">script</span><span style="color: #C9D1D9">></span></span></code></pre>
<p>Now create a new file called firebase-messaging-sw.js in the web folder with the following contents:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #D2A8FF">importScripts</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #D2A8FF">importScripts</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"https://www.gstatic.com/firebasejs/7.5.0/firebase-messaging.js"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">firebase.</span><span style="color: #D2A8FF">initializeApp</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">    apiKey: </span><span style="color: #A5D6FF">"API_KEY"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    authDomain: </span><span style="color: #A5D6FF">"AUTH_DOMAIN"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    databaseURL: </span><span style="color: #A5D6FF">"DATABASE_URL"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    projectId: </span><span style="color: #A5D6FF">"PROJECT_ID"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    storageBucket: </span><span style="color: #A5D6FF">"STORAGE_BUCKET"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    messagingSenderId: </span><span style="color: #A5D6FF">"MESSAGING_SENDER_ID"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    appId: </span><span style="color: #A5D6FF">"APP_ID"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    measurementId: </span><span style="color: #A5D6FF">"MEASUREMENT_ID"</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">messaging</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> firebase.</span><span style="color: #D2A8FF">messaging</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">messaging.</span><span style="color: #D2A8FF">setBackgroundMessageHandler</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">payload</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">promiseChain</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> clients</span></span>
<span class="line"><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">matchAll</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">            type: </span><span style="color: #A5D6FF">"window"</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">            includeUncontrolled: </span><span style="color: #79C0FF">true</span></span>
<span class="line"><span style="color: #C9D1D9">        })</span></span>
<span class="line"><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(</span><span style="color: #FFA657">windowClients</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">let</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> windowClients.</span><span style="color: #79C0FF">length</span><span style="color: #C9D1D9">; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">windowClient</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> windowClients[i];</span></span>
<span class="line"><span style="color: #C9D1D9">                windowClient.</span><span style="color: #D2A8FF">postMessage</span><span style="color: #C9D1D9">(payload);</span></span>
<span class="line"><span style="color: #C9D1D9">            }</span></span>
<span class="line"><span style="color: #C9D1D9">        })</span></span>
<span class="line"><span style="color: #C9D1D9">        .</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">(() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> registration.</span><span style="color: #D2A8FF">showNotification</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">"New Message"</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> promiseChain;</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span>
<span class="line"><span style="color: #C9D1D9">self.</span><span style="color: #D2A8FF">addEventListener</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'notificationclick'</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">function</span><span style="color: #C9D1D9"> (</span><span style="color: #FFA657">event</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">    console.</span><span style="color: #D2A8FF">log</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'notification received: '</span><span style="color: #C9D1D9">, event)</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>Make sure to replace the config keys with your firebase keys.</p>
<h2 id="-1"><a aria-hidden="true" tabindex="-1" href="#-1"><span class="icon icon-link"></span></a>Helper Methods</h2>
<p>Create a new dart file wherever you like named firebase_messaging.dart with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:firebase/firebase.dart'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> firebase;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9">._();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9"> _instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9">._();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">instance</span><span style="color: #C9D1D9"> => _instance;</span></span>
<span class="line"><span style="color: #C9D1D9">  firebase.</span><span style="color: #79C0FF">Messaging</span><span style="color: #C9D1D9"> _mc;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9"> _token;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Map</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">dynamic</span><span style="color: #C9D1D9">>>.</span><span style="color: #D2A8FF">broadcast</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Map</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">dynamic</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller</span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Future</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9">> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    _mc </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> firebase.</span><span style="color: #D2A8FF">messaging</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    _mc.</span><span style="color: #D2A8FF">usePublicVapidKey</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'FCM_SERVER_KEY'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    _mc.onMessage.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">((event) {</span></span>
<span class="line"><span style="color: #C9D1D9">      _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(event</span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9">.data);</span></span>
<span class="line"><span style="color: #C9D1D9">    });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Future</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">requestPermission</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> _mc.</span><span style="color: #D2A8FF">requestPermission</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Future</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">String</span><span style="color: #C9D1D9">> </span><span style="color: #D2A8FF">getToken</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> force </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">]) </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (force </span><span style="color: #FF7B72">||</span><span style="color: #C9D1D9"> _token </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">requestPermission</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">      _token </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> _mc.</span><span style="color: #D2A8FF">getToken</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> _token;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span></code></pre>
<p>Create a button in the app that will be used to request permissions. While it is possible to request for permission when the app launches this is usually bad practice as the user is unlikely to accept and there is no trust built yet. You can request permissions with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _messaging </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9">.instance;</span></span>
<span class="line"><span style="color: #C9D1D9">_messaging.</span><span style="color: #D2A8FF">requestPermission</span><span style="color: #C9D1D9">().</span><span style="color: #D2A8FF">then</span><span style="color: #C9D1D9">((_) </span><span style="color: #FF7B72">async</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _token </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">await</span><span style="color: #C9D1D9"> _messaging.</span><span style="color: #D2A8FF">getToken</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">print</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'Token: $</span><span style="color: #79C0FF">_token</span><span style="color: #A5D6FF">'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<p>You can listen to messages with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _messaging </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FBMessaging</span><span style="color: #C9D1D9">.instance;</span></span>
<span class="line"><span style="color: #C9D1D9">_messaging.stream.</span><span style="color: #D2A8FF">listen</span><span style="color: #C9D1D9">((event) {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #D2A8FF">print</span><span style="color: #C9D1D9">(</span><span style="color: #A5D6FF">'New Message: ${</span><span style="color: #79C0FF">event</span><span style="color: #A5D6FF">}'</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">});</span></span></code></pre>
<h2 id="-2"><a aria-hidden="true" tabindex="-1" href="#-2"><span class="icon icon-link"></span></a>Testing</h2>
<p>Now when you run your application and request permissions you will get a token back. With this token you can open the firebase console and sent a test message to the token.</p>
<img width="100%" src="/attachments/firebase_notification.webp">
<h2 id="-3"><a aria-hidden="true" tabindex="-1" href="#-3"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>Now you can send push notifications to Flutter apps! You still need to use conditional imports to support the mobile side as well but stay tuned for an example with that. Let me know your questions and any feedback you may have.</p>
    </article>
  </main>
    </main>
    <footer class="astro-SZ7XMLTE">
  <div class="links astro-AUSHCPD5">
  <a class="social-icon astro-AUSHCPD5" href="https://github.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/github.svg" alt="github" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://twitter.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/twitter.svg" alt="twitter" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://facebook.com/rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/facebook.svg" alt="facebook" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://instagram.com/rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/instagram.svg" alt="instagram" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://youtube.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/youtube.svg" alt="youtube" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://tiktok.com/@rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/tiktok.svg" alt="tiktok" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://linkedin.com/in/rodydavis" target="_blank" rel="noopener">
            <img src="/social/linkedin.svg" alt="linkedin" class="astro-AUSHCPD5">
          </a>
</div>

  <div class="copyright astro-SZ7XMLTE">
    &copy; 2023
    Rody Davis. All rights reserved.
  </div>
</footer>
  </body></html>