<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="icon" type="image/x-icon" href="/img/favicon/favicon.ico">

<!-- Primary Meta Tags -->
<title>Multi-touch Canvas with Flutter</title>
<meta name="title" content="Multi-touch Canvas with Flutter">
<meta name="description">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url">
<meta property="og:title" content="Multi-touch Canvas with Flutter">
<meta property="og:description">
<meta property="og:image" content="https://astro.build/social.jpg?v=1">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url">
<meta property="twitter:title" content="Multi-touch Canvas with Flutter">
<meta property="twitter:description">
<meta property="twitter:image" content="https://astro.build/social.jpg?v=1">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono&family=IBM+Plex+Sans:wght@400;700&display=swap">
<link href="https://fonts.googleapis.com/css?family=Material+Icons&display=block" rel="stylesheet">
<link rel="stylesheet" href="https://material-foundation.github.io/material-tokens/css/baseline.css"> 
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-themes@1.9.0/themes/prism-lucario.css">

<script type="module" src="https://rodydavis.github.io/material-theme-control/material-theme-control.es.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JQNPVBL9DR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-JQNPVBL9DR');
</script>
	<link rel="stylesheet" href="/assets/BlogContent.6b85ce27.css"></link>
<link rel="stylesheet" href="/assets/social-links.ac123a03.css"></link>
<link rel="stylesheet" href="/assets/_slug_.1ed25ffe.css"></link><style astro-style="true">astro-root, astro-fragment { display: contents; }</style><script type="module" astro-script="/posts/flutter-multi-touch-canvas//script-0">import "../../client-shim.6d491e7a.js";</script>
<script type="module" data-astro-component-hydration astro-script="/posts/flutter-multi-touch-canvas//script-1">import setup from '../../load.732510f7.js';
setup("ZK898Q", {name:"app-header",value: true}, async () => {
  await Promise.all([
  import("../../hydration-support.3bb20349.js")]);
await import("../../app-header.bed0a715.js");
  return () => {};

});
</script>
</head>

	<body>
		<astro-root uid="ZK898Q"><app-header><template shadowroot="open"><style>
    header {
      width: 100%;
      background-color: var(--md-sys-color-primary-container);
      color: var(--md-sys-color-on-primary-container);
      display: flex;
      align-items: center;
      --input-size: 32px;
    }

    .spacer {
      flex: 1;
    }

    .title {
      display: block;
    }

    .title-prefix {
      display: block;
    }

    .title-details {
      max-width: 200px;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    @media (min-width: 200px) {
      .title {
        display: block;
      }
    }

    @media (min-width: 700px) {
      .title-prefix {
        display: block;
      }
      .title-details {
        max-width: 350px;
      }
    }
    @media (min-width: 900px) {
      .title-details {
        max-width: 450px;
      }
    }

    article {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem;
    }

    img {
      margin-right: 1rem;
    }

    h1 {
      margin: 0;
      font-size: 1.5rem;
      max-width: 100%;
      display: flex;
      flex-grow: 1;
    }

    .logo {
      width: 2rem;
      height: 2rem;
    }

    svg {
      width: 2.5rem;
      height: 2.5rem;
    }

    a {
      text-decoration: none;
      display: inline-flex;
      color: var(--md-sys-color-on-primary-container);
      margin-right: 1rem;
    }
    a:hover {
      text-decoration: underline;
    }
    a icon-button {
      margin-left: 3px;
    }
    .actions {
      display: flex;
      align-items: center;
    }

    .links {
      display: none;
    }

    @media (min-width: 600px) {
      .links {
        display: flex;
      }
    }

    .title a {
      display: flex;
      flex-direction: row;
      align-items: center;
    }
    .title a div {
      white-space: nowrap;
    }

    .row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      margin-top: 0.5rem;
    }

    .row icon-button,
    .row input {
      margin-left: 10px;
    }

    .theme-options {
      font-size: 1.5rem;
    }
  </style><!--lit-part ReyuoSOz8+c=--><header class="wrapper">
      <article>
        <h1 class="title">
          <a href="/">
            <div class="title-prefix">Rody Davis</div>
            <!--lit-part F7wN3VMcQAI=--><div class="title-prefix">&nbsp;|&nbsp;</div>
                  <div class="title-details"><!--lit-part-->Multi-touch Canvas with Flutter<!--/lit-part--></div><!--/lit-part-->
          </a>
        </h1>
        <div class="spacer"></div>
        <div class="links">
          <a href="/apps"> Apps </a>
          <a href="/posts"> Blog </a>
          <a href="/talks"> Talks </a>
          <a href="/about"> About </a>
        </div>
        <div class="actions">
          <material-theme-control></material-theme-control>
          <!--lit-part BRUAAAUVAAA=--><?><!--/lit-part-->
        </div>
      </article>
    </header> <!--/lit-part--></template></app-header></astro-root>
		<div class="wrapper">
			<div class="layout astro-6ZXIMRXV">
	<article class="content astro-6ZXIMRXV">
		<div class="astro-6ZXIMRXV">
			<header class="astro-6ZXIMRXV">
				<img width="720" height="420" class="hero-image astro-6ZXIMRXV" loading="lazy" src="/img/flutter/multi-touch.png">
				<p class="publish-date astro-6ZXIMRXV">10 Jun 2020 ~ 26 min read</p>
				<h1 class="title astro-6ZXIMRXV">Multi-touch Canvas with Flutter</h1>
				<div class="author astro-KO5QTRDP">
	<p class="astro-KO5QTRDP"><a href="/about" class="astro-KO5QTRDP">@rodydavis</a></p>
</div>



				 <tag-list class="astro-6ZXIMRXV"><template shadowroot="open"><style>
    .tags {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      margin-left: 2rem;
      margin-right: 2rem;
      width: calc(100% - 4rem);
    }
    tag-item {
      margin-bottom: 0.4rem;
      margin-top: 0.4rem;
    }
    .tags[card] {
      align-items: flex-start;
      justify-content: flex-start;
      margin-left: 0;
    }
  </style><!--lit-part dtEA4j2r9MY=--> <div class="tags" ><!--lit-node 0-->
      <!--lit-part--><!--lit-part VvgdIGM/dSs=--><tag-item  name="posts"><!--lit-node 0--><template shadowroot="open"><style>
    .tag {
      margin-right: 0.5rem;
      padding: 0.25rem 0.5rem;
      background-color: var(--md-sys-color-tertiary);
      color: var(--md-sys-color-on-tertiary);
      border-radius: 8px;
    }

    a {
      text-decoration: none;
      cursor: pointer;
    }
  </style><!--lit-part i7RKEo91zno=--><a href="/tags/posts"><!--lit-node 0-->
      <span class="tag"><!--lit-part-->posts<!--/lit-part--></span>
    </a><!--/lit-part--></template></tag-item><!--/lit-part--><!--lit-part VvgdIGM/dSs=--><tag-item  name="flutter"><!--lit-node 0--><template shadowroot="open"><style>
    .tag {
      margin-right: 0.5rem;
      padding: 0.25rem 0.5rem;
      background-color: var(--md-sys-color-tertiary);
      color: var(--md-sys-color-on-tertiary);
      border-radius: 8px;
    }

    a {
      text-decoration: none;
      cursor: pointer;
    }
  </style><!--lit-part i7RKEo91zno=--><a href="/tags/flutter"><!--lit-node 0-->
      <span class="tag"><!--lit-part-->flutter<!--/lit-part--></span>
    </a><!--/lit-part--></template></tag-item><!--/lit-part--><!--lit-part VvgdIGM/dSs=--><tag-item  name="graphics"><!--lit-node 0--><template shadowroot="open"><style>
    .tag {
      margin-right: 0.5rem;
      padding: 0.25rem 0.5rem;
      background-color: var(--md-sys-color-tertiary);
      color: var(--md-sys-color-on-tertiary);
      border-radius: 8px;
    }

    a {
      text-decoration: none;
      cursor: pointer;
    }
  </style><!--lit-part i7RKEo91zno=--><a href="/tags/graphics"><!--lit-node 0-->
      <span class="tag"><!--lit-part-->graphics<!--/lit-part--></span>
    </a><!--/lit-part--></template></tag-item><!--/lit-part--><!--/lit-part-->
    </div><!--/lit-part--></template></tag-list>
			</header>
			<main class="astro-6ZXIMRXV">
				<div class="layout astro-W2QVQNXU">
	<article class="content astro-W2QVQNXU">
		<div class="astro-W2QVQNXU">
			<main class="astro-W2QVQNXU">
				<p>If you ever wanted to create a canvas in <a href="https://flutter.dev">Flutter</a> that needs to be panned in any direction and allow zoom then you also probably tried to create a <a href="https://api.flutter.dev/flutter/gestures/MultiDragGestureRecognizer-class.html">MultiGestureRecognizer</a> or under a <a href="https://api.flutter.dev/flutter/widgets/GestureDetector-class.html">GestureDetector</a> added onPanUpdate and onScaleUpdate and received an error because both can not work at the same time. Even if you have to GestureDetectors then you will still find it does not work how you want and one will always win.</p>
<p><strong>TLDR</strong> The final source <a href="https://github.com/rodydavis/flutter_multi_touch_canvas">here</a> and an online <a href="https://rodydavis.github.io/flutter_multi_touch_canvas/">demo</a>.</p>
<iframe class="demo" src="https://dartpad.dev/embed-flutter.html?id=e1ead4f4e314691ac8497b004ee679a5&split=80&theme=dark&null_safety=false&split=50&ga_id=flutter-multi-touch-canvas&run=true"></iframe>
<p>This is the canvas rendering logic used in <a href="https://widget.studio">https://widget.studio</a></p>
<h2 id="multi-touch-goal">Multi Touch Goal</h2>
<ul>
<li>Pan the canvas with two or more fingers</li>
<li>Zoom the canvas with two fingers only (Pinch/Zoom)</li>
<li>Single finger will interact with canvas object and detect selection</li>
<li>Bonus trackpad support with similar results</li>
</ul>
<p>In order to achieve this we need to use a Listener for the trackpad events and raw touch interactions and  <a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a> for keyboard shortcuts.</p>
<h2 id="part-1---project-setup">Part 1 - Project Setup</h2>
<p>Open your terminal and type the following:</p>
<pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> flutter_multi_touch
<span class="token builtin class-name">cd</span> flutter_multi_touch
flutter create <span class="token builtin class-name">.</span>
code <span class="token builtin class-name">.</span></code></pre>
<p>The last line is optional and if you have VSCode installed. The command will open the directory inside VSCode.</p>
<h2 id="part-2---boilerplate">Part 2 - Boilerplate</h2>
<ul>
<li>Remove all comments</li>
<li>Remove extra empty lines</li>
<li>Update UI</li>
</ul>
<p>Right now when you run the project you will have this UI.</p>
<p>Create a new file located at <code>ui/home/screen.dart</code> and add the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Update <code>main.dart</code> with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'ui/home/screen.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token class-name">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Flutter Demo'</span></span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> <span class="token class-name">ThemeData</span><span class="token punctuation">(</span>
        primarySwatch<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
        visualDensity<span class="token punctuation">:</span> <span class="token class-name">VisualDensity</span><span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      darkTheme<span class="token punctuation">:</span> <span class="token class-name">ThemeData</span><span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
        visualDensity<span class="token punctuation">:</span> <span class="token class-name">VisualDensity</span><span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>You will now have a black screen when you run the application.</p>
<h2 id="part-3---creating-the-controller">Part 3 - Creating the Controller</h2>
<p>Now we want to create a class that will act as our controller on the canvas.
Create a new file at <code>src/controllers/canvas.dart</code> and add the following to start:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// Control the canvas and the objects on it</span>
<span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span>
  <span class="token comment">// Controller for the stream output</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">StreamController</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Reference to the stream to update the UI</span>
  <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>
  <span class="token comment">// Emit a new event to rebuild the UI</span>
  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">CanvasController</span> val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Stop the stream and finish</span>
  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Start the stream</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Update the home screen with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">Positioned</span><span class="token punctuation">(</span>
                  top<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                  left<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                  height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Here we are just adding the basics to rebuild when the controller changes or the screen is finished. We are using a stateful widget here because we want to dispose of the controller and load it only once. We are also using a stack because thats all we need under the hood. After a quick hot restart you should have the following view.</p>
<h2 id="part-4---adding-canvas-objects">Part 4 - Adding Canvas Objects</h2>
<p>Now we need to create the class for the objects that will be stored on the canvas. Create a new file at <code>src/classes/canvas_object.dart</code> and add the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:ui'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> double dx<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double dy<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double width<span class="token punctuation">;</span>
  <span class="token keyword">final</span> double height<span class="token punctuation">;</span>
  <span class="token keyword">final</span> <span class="token class-name">T</span> child<span class="token punctuation">;</span>

  <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    double dx<span class="token punctuation">,</span>
    double dy<span class="token punctuation">,</span>
    double width<span class="token punctuation">,</span>
    double height<span class="token punctuation">,</span>
    <span class="token class-name">T</span> child<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
      dx<span class="token punctuation">:</span> dx <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dx<span class="token punctuation">,</span>
      dy<span class="token punctuation">:</span> dy <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dy<span class="token punctuation">,</span>
      width<span class="token punctuation">:</span> width <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span>
      height<span class="token punctuation">:</span> height <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> child <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Size</span> <span class="token keyword">get</span> size <span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Offset</span> <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Offset</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Rect</span> <span class="token keyword">get</span> rect <span class="token operator">=</span><span class="token operator">></span> offset <span class="token operator">&amp;</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We are using a generic here to not depend on flutter or material in the class. Update the controller with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// Control the canvas and the objects on it</span>
<span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Controller for the stream output</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">StreamController</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Reference to the stream to update the UI</span>
  <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>

  <span class="token comment">/// Emit a new event to rebuild the UI</span>
  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">CanvasController</span> val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Stop the stream and finish</span>
  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Start the stream</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// -- Canvas Objects --</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current Objects on the canvas</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">></span> _objects<span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span><span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Remove an object from the canvas</span>
  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We are just adding the objects to the canvas and removing them if needed. Update the home screen with the following to use these new objects:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span>
                  <span class="token class-name">Positioned</span><span class="token punctuation">(</span>
                    top<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dy<span class="token punctuation">,</span>
                    left<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dx<span class="token punctuation">,</span>
                    width<span class="token punctuation">:</span> object<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
                    height<span class="token punctuation">:</span> object<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The UI is thee same as before but now is dynamic and we have access to the Stack children and position of each child.</p>
<h2 id="part-5---capture-the-input">Part 5 - Capture the Input</h2>
<p>We need to capture the input of the MultiGestureRecognizer, GestureDetector and RawKeyboardListener. Update the canvas controller with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// Control the canvas and the objects on it</span>
<span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Controller for the stream output</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">StreamController</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Reference to the stream to update the UI</span>
  <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>

  <span class="token comment">/// Emit a new event to rebuild the UI</span>
  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">CanvasController</span> val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Stop the stream and finish</span>
  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Start the stream</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// -- Canvas Objects --</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current Objects on the canvas</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">></span> _objects<span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span><span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Remove an object from the canvas</span>
  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span>
  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token class-name">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Raw events from keys pressed</span>
  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">RawKeyEvent</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Called every time a new finger touches the screen</span>
  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Called when any of the fingers update position</span>
  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Called when a finger is removed from the screen</span>
  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span>
  bool shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">/// Scale of the canvas</span>
  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">></span> _scale<span class="token punctuation">;</span>
  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Max possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>
  <span class="token comment">/// Min possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>
  <span class="token comment">/// How much to scale the canvas in increments</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current offset of the canvas</span>
  <span class="token class-name">Offset</span> <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">></span> _offset<span class="token punctuation">;</span>
  <span class="token class-name">Offset</span> _offset <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Update the home screen with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>
              behavior<span class="token punctuation">:</span> <span class="token class-name">HitTestBehavior</span><span class="token punctuation">.</span>opaque<span class="token punctuation">,</span>
              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">GestureBinding</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver
                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span>
                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token class-name">RawKeyboardListener</span><span class="token punctuation">(</span>
                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span>
                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span>
                      <span class="token class-name">Positioned</span><span class="token punctuation">(</span>
                        top<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dy<span class="token punctuation">,</span>
                        left<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dx<span class="token punctuation">,</span>
                        width<span class="token punctuation">:</span> object<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
                        height<span class="token punctuation">:</span> object<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
                        child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span>
                  <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>All we are doing now is just mapping the inputs of the UI to the actions in the controller. Feel free to look through the comments if you are curious how each one works. Running the application should still just show the red square.</p>
<h2 id="part-5---canvas-offset-and-scale">Part 5 - Canvas Offset and Scale</h2>
<p>Now we want to start moving the canvas. Let’s first tackle the offset as scale will take a different approach. Update the home screen with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>
              behavior<span class="token punctuation">:</span> <span class="token class-name">HitTestBehavior</span><span class="token punctuation">.</span>opaque<span class="token punctuation">,</span>
              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">GestureBinding</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver
                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span>
                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token class-name">RawKeyboardListener</span><span class="token punctuation">(</span>
                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span>
                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span>
                        <span class="token class-name">AnimatedPositioned</span><span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span>
                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>
                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> <span class="token class-name">FittedBox</span><span class="token punctuation">(</span>
                            fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span>
                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">RectUtils</span> <span class="token keyword">on</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
  <span class="token class-name">Rect</span> <span class="token function">adjusted</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now when you use your trackpad to pan with two fingers you will see the red square move. We now need to add finger support too. You may notice the FittedBox and that will come in as soon as we add scaling.</p>
<p>Now if we move the square off the screen we may need to bring it back. We can add a reset button to the AppBar. Add the following to the canvas controller:</p>
<pre class="language-dart"><code class="language-dart">  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">Offset</span> _offsetDefault <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span>
    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>Update the home screen with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>
              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                  tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Reset the Scale and Offset'</span></span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>
              behavior<span class="token punctuation">:</span> <span class="token class-name">HitTestBehavior</span><span class="token punctuation">.</span>opaque<span class="token punctuation">,</span>
              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">GestureBinding</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver
                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span>
                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token class-name">RawKeyboardListener</span><span class="token punctuation">(</span>
                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span>
                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span>
                        <span class="token class-name">AnimatedPositioned</span><span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span>
                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>
                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> <span class="token class-name">FittedBox</span><span class="token punctuation">(</span>
                            fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span>
                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">RectUtils</span> <span class="token keyword">on</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
  <span class="token class-name">Rect</span> <span class="token function">adjusted</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now when you press the reset button the canvas animates back to the default offset and scale.</p>
<p>While we are here we can add actions for zoom in/out and connect them to the controller. Add the following to the canvas controller:</p>
<pre class="language-dart"><code class="language-dart">  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>Add the following to the AppBar actions:</p>
<pre class="language-dart"><code class="language-dart">				  <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                  tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom In'</span></span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                  tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom Out'</span></span><span class="token punctuation">,</span>
                  icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span>
                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre>
<p>Now when you run the application you can easily zoom in/out.</p>
<h2 id="part-6---keyboard-shortcuts">Part 6 - Keyboard Shortcuts</h2>
<p>Now we need to capture the keyboard events so we can move the canvas with the arrow keys and scale with +/- keys. Update the controller with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/services.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// Control the canvas and the objects on it</span>
<span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Controller for the stream output</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">StreamController</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Reference to the stream to update the UI</span>
  <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>

  <span class="token comment">/// Emit a new event to rebuild the UI</span>
  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">CanvasController</span> val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Stop the stream and finish</span>
  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Start the stream</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// -- Canvas Objects --</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current Objects on the canvas</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">></span> _objects<span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span><span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Remove an object from the canvas</span>
  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span>
  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token class-name">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Raw events from keys pressed</span>
  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">RawKeyEvent</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Scale keys</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>minus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>equal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Directional Keys</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowLeft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowRight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowDown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span>offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _shiftPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isShiftPressed<span class="token punctuation">;</span>

    <span class="token comment">/// Update Controller Instance</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Called every time a new finger touches the screen</span>
  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Called when any of the fingers update position</span>
  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Called when a finger is removed from the screen</span>
  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span>
  bool <span class="token keyword">get</span> shiftPressed <span class="token operator">=</span><span class="token operator">></span> _shiftPressed<span class="token punctuation">;</span>
  bool _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">/// Scale of the canvas</span>
  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">></span> _scale<span class="token punctuation">;</span>
  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Max possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>

  <span class="token comment">/// Min possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>

  <span class="token comment">/// How much to scale the canvas in increments</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>

  <span class="token comment">/// How much to shift the canvas in increments</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double offsetAdjust <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current offset of the canvas</span>
  <span class="token class-name">Offset</span> <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">></span> _offset<span class="token punctuation">;</span>
  <span class="token class-name">Offset</span> _offset <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">Offset</span> _offsetDefault <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

  <span class="token comment">/// Reset the canvas zoom and offset</span>
  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span>
    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Zoom in the canvas</span>
  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Zoom out the canvas</span>
  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now when you run the application you can control the zoom and pan with just a keyboard. This could be useful for a fallback input that would work on a TV for example…</p>
<p>If you want to see if it is actually scaling proportionally then add the following the home screen:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>
              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom In'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom Out'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Reset the Scale and Offset'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>
              behavior<span class="token punctuation">:</span> <span class="token class-name">HitTestBehavior</span><span class="token punctuation">.</span>opaque<span class="token punctuation">,</span>
              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">GestureBinding</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver
                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span>
                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token class-name">RawKeyboardListener</span><span class="token punctuation">(</span>
                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span>
                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span>
                        <span class="token class-name">AnimatedPositioned</span><span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span>
                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>
                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> <span class="token class-name">FittedBox</span><span class="token punctuation">(</span>
                            fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span>
                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">RectUtils</span> <span class="token keyword">on</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
  <span class="token class-name">Rect</span> <span class="token function">adjusted</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>You can zoom and the blocks all scale correctly and pan around.</p>
<p>Just press the reset button to start over.</p>
<h2 id="part-7---multi-touch-input">Part 7 - Multi Touch Input</h2>
<p>Now time for the fingers. For this you will need a touchscreen device to test. You can plug in your phone or if you have a touch screen computer you can run the web version. Update the controller with following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:async'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:math'</span></span> <span class="token operator">as</span> math<span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/services.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../classes/rect_points.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">/// Control the canvas and the objects on it</span>
<span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span>
  <span class="token comment">/// Controller for the stream output</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">StreamController</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Reference to the stream to update the UI</span>
  <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span>

  <span class="token comment">/// Emit a new event to rebuild the UI</span>
  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token class-name">CanvasController</span> val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Stop the stream and finish</span>
  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Start the stream</span>
  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// -- Canvas Objects --</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current Objects on the canvas</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">></span> _objects<span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span><span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Add an object to the canvas</span>
  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> <span class="token class-name">CanvasObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span></span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Remove an object from the canvas</span>
  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span>
  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token class-name">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Raw events from keys pressed</span>
  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">,</span> <span class="token class-name">RawKeyEvent</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Scale keys</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>minus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>equal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Directional Keys</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowLeft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowRight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span><span class="token class-name">LogicalKeyboardKey</span><span class="token punctuation">.</span>arrowDown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token class-name">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span>offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    _shiftPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isShiftPressed<span class="token punctuation">;</span>
    _metaPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isMetaPressed<span class="token punctuation">;</span>

    <span class="token comment">/// Update Controller Instance</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Trigger Shift Press</span>
  <span class="token keyword">void</span> <span class="token function">shiftSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _shiftPressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Trigger Meta Press</span>
  <span class="token keyword">void</span> <span class="token function">metaSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _metaPressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span>int<span class="token punctuation">,</span> <span class="token class-name">Offset</span><span class="token punctuation">></span></span> _pointerMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">/// Number of inputs currently on the screen</span>
  int <span class="token keyword">get</span> touchCount <span class="token operator">=</span><span class="token operator">></span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token comment">/// Marquee selection on the canvas</span>
  <span class="token class-name">RectPoints</span> <span class="token keyword">get</span> marquee <span class="token operator">=</span><span class="token operator">></span> _marquee<span class="token punctuation">;</span>
  <span class="token class-name">RectPoints</span> _marquee<span class="token punctuation">;</span>

  <span class="token comment">/// Dragging a canvas object</span>
  bool <span class="token keyword">get</span> isMovingCanvasObject <span class="token operator">=</span><span class="token operator">></span> _isMovingCanvasObject<span class="token punctuation">;</span>
  bool _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>int<span class="token punctuation">></span></span> _selectedObjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>int<span class="token punctuation">></span></span> <span class="token keyword">get</span> selectedObjectsIndices <span class="token operator">=</span><span class="token operator">></span> _selectedObjects<span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasObject</span><span class="token punctuation">&lt;</span><span class="token class-name">Widget</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token keyword">get</span> selectedObjects <span class="token operator">=</span><span class="token operator">></span>
      _selectedObjects<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  bool <span class="token function">isObjectSelected</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _selectedObjects<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Called every time a new input touches the screen</span>
  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">final</span> pt <span class="token operator">=</span> <span class="token punctuation">(</span>offsetVal <span class="token operator">/</span> scale<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
      _marquee <span class="token operator">=</span> <span class="token class-name">RectPoints</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Update Controller Instance</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Called when any of the inputs update position</span>
  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> <span class="token class-name">Offset</span> offsetVal<span class="token punctuation">,</span> <span class="token class-name">Offset</span> globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Update New Widget Rect</span>
      <span class="token keyword">final</span> _pts <span class="token operator">=</span> _marquee<span class="token punctuation">;</span>
      <span class="token keyword">final</span> a <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>
      <span class="token keyword">final</span> b <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      <span class="token keyword">final</span> delta <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> scale<span class="token punctuation">;</span>
      _pts<span class="token punctuation">.</span>end <span class="token operator">=</span> _pts<span class="token punctuation">.</span>end <span class="token operator">+</span> delta<span class="token punctuation">;</span>
      _marquee <span class="token operator">=</span> _pts<span class="token punctuation">;</span>
      <span class="token keyword">final</span> _rect <span class="token operator">=</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>_pts<span class="token punctuation">.</span>start<span class="token punctuation">,</span> _pts<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
      _selectedObjects<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_rect<span class="token punctuation">.</span><span class="token function">overlaps</span><span class="token punctuation">(</span>_objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _selectedObjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Widget Move</span>
      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> a <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>
      <span class="token keyword">final</span> b <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>_selectedObjects<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> idx <span class="token keyword">in</span> _selectedObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> widget <span class="token operator">=</span> _objects<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> delta <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> scale<span class="token punctuation">;</span>
        <span class="token keyword">final</span> _newOffset <span class="token operator">=</span> widget<span class="token punctuation">.</span>offset <span class="token operator">+</span> delta<span class="token punctuation">;</span>
        _objects<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> widget<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>dx<span class="token punctuation">:</span> _newOffset<span class="token punctuation">.</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">:</span> _newOffset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Scale and Rotate Update</span>
      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> _rectA <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>
      <span class="token keyword">final</span> _rectB <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> _delta <span class="token operator">=</span> _rectB<span class="token punctuation">.</span>center <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
      <span class="token keyword">final</span> _newOffset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token punctuation">(</span>_delta <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
      offset <span class="token operator">=</span> _newOffset<span class="token punctuation">;</span>
      <span class="token keyword">final</span> aDistance <span class="token operator">=</span> <span class="token punctuation">(</span>_rectA<span class="token punctuation">.</span>topLeft <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>bottomRight<span class="token punctuation">)</span><span class="token punctuation">.</span>distance<span class="token punctuation">;</span>
      <span class="token keyword">final</span> bDistance <span class="token operator">=</span> <span class="token punctuation">(</span>_rectB<span class="token punctuation">.</span>topLeft <span class="token operator">-</span> _rectB<span class="token punctuation">.</span>bottomRight<span class="token punctuation">)</span><span class="token punctuation">.</span>distance<span class="token punctuation">;</span>
      <span class="token keyword">final</span> change <span class="token operator">=</span> <span class="token punctuation">(</span>bDistance <span class="token operator">/</span> aDistance<span class="token punctuation">)</span><span class="token punctuation">;</span>
      scale <span class="token operator">=</span> scale <span class="token operator">*</span> change<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Pan Update</span>
      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> _rectA <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>
      <span class="token keyword">final</span> _rectB <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">final</span> _delta <span class="token operator">=</span> _rectB<span class="token punctuation">.</span>center <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>center<span class="token punctuation">;</span>
      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token punctuation">(</span>_delta <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span>

    <span class="token comment">/// Update Controller Instance</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Called when a input is removed from the screen</span>
  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _pointerMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>_marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _marquee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// Update Controller Instance</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">selectObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_metaPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _selectedObjects<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        _selectedObjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> item <span class="token operator">=</span> _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        _objects<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span>
  bool <span class="token keyword">get</span> shiftPressed <span class="token operator">=</span><span class="token operator">></span> _shiftPressed<span class="token punctuation">;</span>
  bool _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">/// Checks if the meta key on the keyboard is pressed</span>
  bool <span class="token keyword">get</span> metaPressed <span class="token operator">=</span><span class="token operator">></span> _metaPressed<span class="token punctuation">;</span>
  bool _metaPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

  <span class="token comment">/// Scale of the canvas</span>
  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">></span> _scale<span class="token punctuation">;</span>
  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;=</span> minScale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> minScale<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">>=</span> maxScale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          value <span class="token operator">=</span> maxScale<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/// Max possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span>

  <span class="token comment">/// Min possible scale</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span>

  <span class="token comment">/// How much to scale the canvas in increments</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span>

  <span class="token comment">/// How much to shift the canvas in increments</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> double offsetAdjust <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span>

  <span class="token comment">/// Current offset of the canvas</span>
  <span class="token class-name">Offset</span> <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">></span> _offset<span class="token punctuation">;</span>
  <span class="token class-name">Offset</span> _offset <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>
  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token class-name">Offset</span> _offsetDefault <span class="token operator">=</span> <span class="token class-name">Offset</span><span class="token punctuation">.</span>zero<span class="token punctuation">;</span>

  <span class="token comment">/// Reset the canvas zoom and offset</span>
  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span>
    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Zoom in the canvas</span>
  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/// Zoom out the canvas</span>
  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Rect</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Offset</span><span class="token punctuation">></span></span> offsets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>offsets<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>offsets<span class="token punctuation">.</span>first<span class="token punctuation">,</span> offsets<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> dxs <span class="token operator">=</span> offsets<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> e<span class="token punctuation">.</span>dx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> dys <span class="token operator">=</span> offsets<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> e<span class="token punctuation">.</span>dy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    double left <span class="token operator">=</span> <span class="token function">_minFromList</span><span class="token punctuation">(</span>dxs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    double top <span class="token operator">=</span> <span class="token function">_minFromList</span><span class="token punctuation">(</span>dys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    double bottom <span class="token operator">=</span> <span class="token function">_maxFromList</span><span class="token punctuation">(</span>dys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    double right <span class="token operator">=</span> <span class="token function">_maxFromList</span><span class="token punctuation">(</span>dxs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  double <span class="token function">_minFromList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    double value <span class="token operator">=</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  double <span class="token function">_maxFromList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>double<span class="token punctuation">></span></span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    double value <span class="token operator">=</span> <span class="token operator">-</span>double<span class="token punctuation">.</span>infinity<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Add a new file <code>src/classes/rect_points.dart</code> and add the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:ui'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">RectPoints</span> <span class="token punctuation">{</span>
  <span class="token class-name">RectPoints</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Offset</span> start<span class="token punctuation">,</span> end<span class="token punctuation">;</span>

  <span class="token class-name">Rect</span> <span class="token keyword">get</span> rect <span class="token operator">=</span><span class="token operator">></span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Update the <code>main.dart</code> with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'ui/home/screen.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token class-name">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">MaterialApp</span><span class="token punctuation">(</span>
      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      title<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Flutter Demo'</span></span><span class="token punctuation">,</span>
      theme<span class="token punctuation">:</span> <span class="token class-name">ThemeData</span><span class="token punctuation">(</span>
        primarySwatch<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>blue<span class="token punctuation">,</span>
        accentColor<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">,</span>
        visualDensity<span class="token punctuation">:</span> <span class="token class-name">VisualDensity</span><span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      darkTheme<span class="token punctuation">:</span> <span class="token class-name">ThemeData</span><span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>
        visualDensity<span class="token punctuation">:</span> <span class="token class-name">VisualDensity</span><span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      home<span class="token punctuation">:</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Update the home screen with the following:</p>
<pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/gestures.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/material.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/classes/canvas_object.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'../../src/controllers/canvas.dart'</span></span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token class-name">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">Key</span> key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> _HomeScreenState <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HomeScreen</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token class-name">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span>
      <span class="token class-name">CanvasObject</span><span class="token punctuation">(</span>
        dx<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        dy<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata function">@override</span>
  <span class="token class-name">Widget</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">BuildContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">StreamBuilder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CanvasController</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span>
        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
              appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              body<span class="token punctuation">:</span> <span class="token class-name">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token class-name">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Scaffold</span><span class="token punctuation">(</span>
            appBar<span class="token punctuation">:</span> <span class="token class-name">AppBar</span><span class="token punctuation">(</span>
              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Selection'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>select_all<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>shiftPressed
                        <span class="token operator">?</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>accentColor
                        <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>shiftSelect<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Meta Key'</span></span><span class="token punctuation">,</span>
                    color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>metaPressed
                        <span class="token operator">?</span> <span class="token class-name">Theme</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>accentColor
                        <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>category<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>metaSelect<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom In'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Zoom Out'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">FocusScope</span><span class="token punctuation">(</span>
                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">IconButton</span><span class="token punctuation">(</span>
                    tooltip<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">'Reset the Scale and Offset'</span></span><span class="token punctuation">,</span>
                    icon<span class="token punctuation">:</span> <span class="token class-name">Icon</span><span class="token punctuation">(</span><span class="token class-name">Icons</span><span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>
              behavior<span class="token punctuation">:</span> <span class="token class-name">HitTestBehavior</span><span class="token punctuation">.</span>opaque<span class="token punctuation">,</span>
              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  <span class="token class-name">GestureBinding</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver
                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> <span class="token class-name">PointerScrollEvent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span>
                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span>
                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span>
                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token class-name">RawKeyboardListener</span><span class="token punctuation">(</span>
                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span>
                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                        <span class="token class-name">Positioned</span><span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span>
                          rect<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>
                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span>
                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
                            decoration<span class="token punctuation">:</span> <span class="token class-name">BoxDecoration</span><span class="token punctuation">(</span>
                                border<span class="token punctuation">:</span> <span class="token class-name">Border</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                              color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span><span class="token function">isObjectSelected</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                                  <span class="token operator">?</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>grey
                                  <span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>transparent<span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            child<span class="token punctuation">:</span> <span class="token class-name">GestureDetector</span><span class="token punctuation">(</span>
                              onTapDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> _controller<span class="token punctuation">.</span><span class="token function">selectObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> <span class="token class-name">FittedBox</span><span class="token punctuation">(</span>
                                fit<span class="token punctuation">:</span> <span class="token class-name">BoxFit</span><span class="token punctuation">.</span>fill<span class="token punctuation">,</span>
                                child<span class="token punctuation">:</span> <span class="token class-name">SizedBox</span><span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span>
                                  size<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">,</span>
                                  child<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span>
                                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token operator">?</span><span class="token punctuation">.</span>marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token class-name">Positioned</span><span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span>
                          rect<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>marquee<span class="token punctuation">.</span>rect
                              <span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> instance<span class="token punctuation">.</span>scale<span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> <span class="token class-name">Container</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> <span class="token class-name">Colors</span><span class="token punctuation">.</span>blueAccent<span class="token punctuation">.</span><span class="token function">withOpacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">RectUtils</span> <span class="token keyword">on</span> <span class="token class-name">Rect</span> <span class="token punctuation">{</span>
  <span class="token class-name">Rect</span> <span class="token function">adjusted</span><span class="token punctuation">(</span><span class="token class-name">Offset</span> offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">Rect</span><span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Now you can move any object on the canvas just by clicking and dragging. You can zoom with 2 fingers and pan with 2 or 3 fingers. If you hold down the shift key then you can use a marquee to select multiple and if you hold down the meta/command key then you can select multiple by tapping each.</p>
<h2 id="conclusion">Conclusion</h2>
<p>If you are on a device without a keyboard you can tap the new icons to turn on the keyboard key actions. When the object is selected there is a grey border.</p>
<p>Now you can add any widget to the canvas and pan and zoom!</p>
			</main>
		</div>
	</article>
</div>



			</main>
		</div>
	</article>
</div>



		</div>
		<div style="height: 25px"></div>
		<social-links><template shadowroot="open"><style>
    footer {
      display: flex;
      justify-content: center;
      align-items: center;
      width: var(--width, 100%);
      margin-bottom: 2rem;
    }
    .fab,
    svg {
      --size: 3vw;
      width: var(--size);
      height: var(--size);
      max-width: 30px;
      max-height: 30px;
      min-width: 20px;
      min-height: 20px;
      margin: 0.5rem;
      color: var(--md-sys-color-on-surface);
      font-family: FontAwesome;
      cursor: pointer;
    }
    svg {
      color: var(--md-sys-color-on-surface);
    }
  </style><!--lit-part fkbI1zGBADw=--><footer>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://twitter.com/rodydavis"
        class="fab fa fa-twitter"
      >
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="twitter"
          class="svg-inline--fa fa-twitter fa-w-16"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        >
          <path
            fill="currentColor"
            d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"
          ></path>
        </svg>
      </a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://facebook.com/rodydavisjr"
        class="fab fa fa-facebook"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="facebook-f"
          class="svg-inline--fa fa-facebook-f fa-w-10"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 320 512"
        >
          <path
            fill="currentColor"
            d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"
          ></path></svg
      ></a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://www.linkedin.com/in/rodydavis"
        class="fab fa fa-linkedin"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="linkedin-in"
          class="svg-inline--fa fa-linkedin-in fa-w-14"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 448 512"
        >
          <path
            fill="currentColor"
            d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"
          ></path></svg
      ></a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://www.youtube.com/rodydavis"
        class="fab fa fa-youtube"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="youtube"
          class="svg-inline--fa fa-youtube fa-w-18"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 576 512"
        >
          <path
            fill="currentColor"
            d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"
          ></path></svg
      ></a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://www.instagram.com/rodydavisjr"
        class="fab fa fa-instagram"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="instagram"
          class="svg-inline--fa fa-instagram fa-w-14"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 448 512"
        >
          <path
            fill="currentColor"
            d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"
          ></path></svg
      ></a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://www.github.com/rodydavis"
        class="fab fa fa-github"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="github"
          class="svg-inline--fa fa-github fa-w-16"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 496 512"
        >
          <path
            fill="currentColor"
            d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"
          ></path></svg
      ></a>
      <a
        target="_blank"
        rel="noopener noreferrer"
        href="https://www.tiktok.com/@rodydavisjr"
        class="fab fa-tiktok"
        ><svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fab"
          data-icon="tiktok"
          class="svg-inline--fa fa-tiktok fa-w-14"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 448 512"
        >
          <path
            fill="currentColor"
            d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"
          ></path></svg
      ></a>
    </footer><!--/lit-part--></template></social-links>
	</body></html>