<!DOCTYPE html><html domain="rodydavis.com" ga-id="G-JQNPVBL9DR" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="default-src 'self';object-src 'none';script-src 'self' 'sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=';style-src 'unsafe-inline';img-src 'self' data:" http-equiv="Content-Security-Policy"><link href="/img/favicon/favicon-192x192.png?hash=2089033c93" rel="icon" type="image/png"><meta content="#f9c412" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>Multi-touch Canvas with Flutter</title><meta content="Multi-touch Canvas with Flutter" property="og:title"><meta content="If you ever wanted to create a canvas in Flutter that needs to be panned in any direction and allow zoom then you also probably tried to..." name="description"><meta content="If you ever wanted to create a canvas in Flutter that needs to be panned in any direction and allow zoom then you also probably tried to..." property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@rodydavis" name="twitter:site"><meta content="@rodydavis" name="twitter:creator"><link href="https://rodydavis.com/posts/flutter-multi-touch-canvas/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Rody Davis"><link href="/" rel="preconnect" crossorigin=""><script async="" defer="" src="/js/min.js?hash=c372ec6a84"></script><script async="" defer="" src="/js/cached.js?hash=9030142fbb"></script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary: #f9c412;--secondary: #e7bf60;--background: #181818;--on-background: #eee;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{position:fixed;padding:.375em 1.5em;background:rgba(255,255,255,.9);font-weight:200;text-align:right}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px}share-widget div{width:30px;height:30px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center}.apple share-widget div{background-image:url(/img/share-apple.svg)}body,share-widget button{margin:0}share-widget button:active{transform:scale(1.2)}dialog{background-color:#8dff80;z-index:1000}header aside{font-style:italic}#nav{z-index:2;position:relative}#reading-progress,header nav{z-index:1;width:100vw;left:0;top:0}#reading-progress{background-color:var(--primary);position:absolute;bottom:0;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:100;src:url(/fonts/Inter-Thin.woff2) format("woff2"),url(/fonts/Inter-Thin.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:100;src:url(/fonts/Inter-ThinItalic.woff2) format("woff2"),url(/fonts/Inter-ThinItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:200;src:url(/fonts/Inter-ExtraLight.woff2) format("woff2"),url(/fonts/Inter-ExtraLight.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:200;src:url(/fonts/Inter-ExtraLightItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraLightItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:300;src:url(/fonts/Inter-Light.woff2) format("woff2"),url(/fonts/Inter-Light.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:300;src:url(/fonts/Inter-LightItalic.woff2) format("woff2"),url(/fonts/Inter-LightItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:500;src:url(/fonts/Inter-Medium.woff2) format("woff2"),url(/fonts/Inter-Medium.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:500;src:url(/fonts/Inter-MediumItalic.woff2) format("woff2"),url(/fonts/Inter-MediumItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:700;src:url(/fonts/Inter-Bold.woff2) format("woff2"),url(/fonts/Inter-Bold.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:700;src:url(/fonts/Inter-BoldItalic.woff2) format("woff2"),url(/fonts/Inter-BoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:800;src:url(/fonts/Inter-ExtraBold.woff2) format("woff2"),url(/fonts/Inter-ExtraBold.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:800;src:url(/fonts/Inter-ExtraBoldItalic.woff2) format("woff2"),url(/fonts/Inter-ExtraBoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:900;src:url(/fonts/Inter-Black.woff2) format("woff2"),url(/fonts/Inter-Black.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:900;src:url(/fonts/Inter-BlackItalic.woff2) format("woff2"),url(/fonts/Inter-BlackItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI var alt";font-weight:100 900;font-style:normal;font-named-instance:"Regular";src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:optional;font-family:"Inter UI var alt";font-weight:100 900;font-style:italic;font-named-instance:"Italic";src:url(/fonts/Inter-italic.var.woff2) format("woff2")}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:Inter UI,sans-serif;--font-family: Inter UI, sans-serif}h1{font-size:3em;line-height:1.25;margin:.67em 0 .5em;font-size:2.074rem}a{background-color:transparent;color:#f9c412;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,input,select{font-family:inherit;font-size:100%;line-height:1.15}input,select{margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}details{display:block}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em}body,p,pre,ul{font-size:1em}p,pre,ul{margin-bottom:1.5em}h1,h2{line-height:2.4rem;margin-bottom:1.36rem}h2{font-size:1.728rem}body,p,pre,ul{font-size:1rem;line-height:1.6}p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h1{font-size:4.3978rem;line-height:4.4rem}h2{font-size:3.1097rem;line-height:3.52rem}body,p,pre,ul{font-size:1.1rem;line-height:1.6}h1,h2,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h1{font-size:6.0756rem;line-height:6.72rem}h2{font-size:4.05rem;line-height:4.8rem}body,p,pre,ul{font-size:1.2rem;line-height:1.6}h1,h2,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){padding:1.5em;overflow-x:scroll}code{border-radius:.3em;color:#e2777a;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%;background:#2d2d2d;padding:0}h1,h2{font-family:var(--font-family)}h2{font-style:italic}a:hover{text-decoration:underline}dt{font-weight:600;padding-top:.75em;padding-left:.75em}@supports (font-variation-settings:normal){html{font-family:Inter UI var alt,sans-serif;--font-family: Inter UI var alt, sans-serif}}button,input,select{border-radius:.3em;max-width:100%}input{padding:.75em}input,select{margin-bottom:1.5em;display:inline}button,input[type=reset]{background:#f2f2f2;color:#191919;cursor:pointer;display:inline-block;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover,input[type=reset]:hover{background:#d9d9d9;color:var(--surface)}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--secondary)}input[type=color],input[type=datetime],input[type=file],input[type=number],input[type=phone],input[type=time],input[type=url],select{border:1px solid #595959;padding:.75em}select[multiple]{min-width:15em}*{border:0;box-sizing:border-box}body,header nav a{font-family:var(--font-family)}body{background:var(--background);color:var(--on-background)}header{padding:4.5em 1.5em 3em;width:37.5em;margin:0 auto;text-align:center;max-width:100%;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav h1{float:left;font-size:inherit;line-height:inherit;margin:0;text-align:left}header nav a{font-weight:700;text-decoration:none;color:#181818;margin-left:1.5em}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}main{max-width:70rem;margin:0 auto;border-top:.5px solid #ccc}footer{background:var(--background);color:var(--on-background);padding:3em;text-align:center}footer>*{margin:1.5em}footer nav a img{vertical-align:middle}footer nav,footer p{font-size:90%}article{max-width:100%;padding:1.5em;width:37.5em;margin:0 auto}li ul{margin-bottom:0}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#2d2d2d}.token.comment,.token.doctype{color:#999}.token.punctuation{color:#ccc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.property,.token.symbol{color:#f8c555}.token.builtin,.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.inserted{color:green}</style></head><body><header><nav><div id="nav"><h1><a href="/" title="Homepage">Rody Davis</a></h1><a href="/about/">About</a> <a href="/privacy/">Privacy</a></div><div id="reading-progress" aria-hidden="true"></div></nav><h1>Multi-touch Canvas with Flutter</h1><aside>22 min read.</aside><dialog id="message"></dialog><noscript><img alt="" height=1 src="/.netlify/functions/ga?v=1&_v=j83&t=pageview&dr=https%3A%2F%2Fno-script.com&_s=1&dh=rodydavis.com&dp=%2Fposts%2Fflutter-multi-touch-canvas%2F&ul=en-us&de=UTF-8&dt=Multi-touch%20Canvas%20with%20Flutter&tid=G-JQNPVBL9DR" style=display:none width=1></noscript></header><main><article><p>If you ever wanted to create a canvas in <a href="https://flutter.dev">Flutter</a> that needs to be panned in any direction and allow zoom then you also probably tried to create a <a href="https://api.flutter.dev/flutter/gestures/MultiDragGestureRecognizer-class.html">MultiGestureRecognizer</a> or under a <a href="https://api.flutter.dev/flutter/widgets/GestureDetector-class.html">GestureDetector</a> added onPanUpdate and onScaleUpdate and received an error because both can not work at the same time. Even if you have to GestureDetectors then you will still find it does not work how you want and one will always win.</p><p>Online demo: <a href="https://rodydavis.github.io/flutter_multi_touch_canvas/">https://rodydavis.github.io/flutter_multi_touch_canvas/</a></p><p>This is the canvas rendering logic used in <a href="https://widget.studio">https://widget.studio</a></p><h2 id="multi-touch-goal">Multi Touch Goal <a href="#multi-touch-goal" class="direct-link">#</a></h2><ul><li>Pan the canvas with two or more fingers</li><li>Zoom the canvas with two fingers only (Pinch/Zoom)</li><li>Single finger will interact with canvas object and detect selection</li><li>Bonus trackpad support with similar results</li></ul><p>In order to achieve this we need to use a Listener for the trackpad events and raw touch interactions and <a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a> for keyboard shortcuts.</p><h2 id="part-1---project-setup">Part 1 - Project Setup <a href="#part-1---project-setup" class="direct-link">#</a></h2><p>Open your terminal and type the following:</p><pre class="language-bash"><code class="language-bash"><span class="token function">mkdir</span> flutter_multi_touch<br><span class="token class-name builtin">cd</span> flutter_multi_touch<br>flutter create <span class="token class-name builtin">.</span><br>code <span class="token class-name builtin">.</span></code></pre><p>The last line is optional and if you have VSCode installed. The command will open the directory inside VSCode.</p><h2 id="part-2---boilerplate">Part 2 - Boilerplate <a href="#part-2---boilerplate" class="direct-link">#</a></h2><ul><li>Remove all comments</li><li>Remove extra empty lines</li><li>Update UI</li></ul><p>Right now when you run the project you will have this UI.</p><p>Create a new file located at <code>ui/home/screen.dart</code> and add the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Update <code>main.dart</code> with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'ui/home/screen.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span><br>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Demo'</span><span class="token punctuation">,</span><br>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span><br>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span><br>        visualDensity<span class="token punctuation">:</span> VisualDensity<span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>      darkTheme<span class="token punctuation">:</span> ThemeData<span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span><br>        visualDensity<span class="token punctuation">:</span> VisualDensity<span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>      home<span class="token punctuation">:</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>You will now have a black screen when you run the application.</p><h2 id="part-3---creating-the-controller">Part 3 - Creating the Controller <a href="#part-3---creating-the-controller" class="direct-link">#</a></h2><p>Now we want to create a class that will act as our controller on the canvas.<br>Create a new file at <code>src/controllers/canvas.dart</code> and add the following to start:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span><br><br><span class="token comment">/// Control the canvas and the objects on it</span><br><span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Controller for the stream output</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> StreamController<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Reference to the stream to update the UI</span><br>  Stream<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><br>  <span class="token comment">// Emit a new event to rebuild the UI</span><br>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CanvasController val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// Stop the stream and finish</span><br>  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token comment">// Start the stream</span><br>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><p>Update the home screen with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>              children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token function">Positioned</span><span class="token punctuation">(</span><br>                  top<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>                  left<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>                  width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>                  height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><br>              <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Here we are just adding the basics to rebuild when the controller changes or the screen is finished. We are using a stateful widget here because we want to dispose of the controller and load it only once. We are also using a stack because thats all we need under the hood. After a quick hot restart you should have the following view.</p><h2 id="part-4---adding-canvas-objects">Part 4 - Adding Canvas Objects <a href="#part-4---adding-canvas-objects" class="direct-link">#</a></h2><p>Now we need to create the class for the objects that will be stored on the canvas. Create a new file at <code>src/classes/canvas_object.dart</code> and add the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:ui'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">CanvasObject</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> double dx<span class="token punctuation">;</span><br>  <span class="token keyword">final</span> double dy<span class="token punctuation">;</span><br>  <span class="token keyword">final</span> double width<span class="token punctuation">;</span><br>  <span class="token keyword">final</span> double height<span class="token punctuation">;</span><br>  <span class="token keyword">final</span> T child<span class="token punctuation">;</span><br><br>  <span class="token function">CanvasObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>dx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>dy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  CanvasObject<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token function">copyWith</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    double dx<span class="token punctuation">,</span><br>    double dy<span class="token punctuation">,</span><br>    double width<span class="token punctuation">,</span><br>    double height<span class="token punctuation">,</span><br>    T child<span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> CanvasObject<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>      dx<span class="token punctuation">:</span> dx <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dx<span class="token punctuation">,</span><br>      dy<span class="token punctuation">:</span> dy <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dy<span class="token punctuation">,</span><br>      width<span class="token punctuation">:</span> width <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span><br>      height<span class="token punctuation">:</span> height <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span><br>      child<span class="token punctuation">:</span> child <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  Size <span class="token keyword">get</span> size <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Size</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  Offset <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Offset</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  Rect <span class="token keyword">get</span> rect <span class="token operator">=</span><span class="token operator">&gt;</span> offset <span class="token operator">&amp;</span> size<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><p>We are using a generic here to not depend on flutter or material in the class. Update the controller with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><br><span class="token comment">/// Control the canvas and the objects on it</span><br><span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span><br>  <span class="token comment">/// Controller for the stream output</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> StreamController<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reference to the stream to update the UI</span><br>  Stream<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Emit a new event to rebuild the UI</span><br>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CanvasController val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Stop the stream and finish</span><br>  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Start the stream</span><br>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// -- Canvas Objects --</span><br><br>  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current Objects on the canvas</span><br>  List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">&gt;</span> _objects<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Remove an object from the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>We are just adding the objects to the canvas and removing them if needed. Update the home screen with the following to use these new objects:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>              children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span><br>                  <span class="token function">Positioned</span><span class="token punctuation">(</span><br>                    top<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dy<span class="token punctuation">,</span><br>                    left<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dx<span class="token punctuation">,</span><br>                    width<span class="token punctuation">:</span> object<span class="token punctuation">.</span>width<span class="token punctuation">,</span><br>                    height<span class="token punctuation">:</span> object<span class="token punctuation">.</span>height<span class="token punctuation">,</span><br>                    child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><br>              <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>The UI is thee same as before but now is dynamic and we have access to the Stack children and position of each child.</p><h2 id="part-5---capture-the-input">Part 5 - Capture the Input <a href="#part-5---capture-the-input" class="direct-link">#</a></h2><p>We need to capture the input of the MultiGestureRecognizer, GestureDetector and RawKeyboardListener. Update the canvas controller with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><br><span class="token comment">/// Control the canvas and the objects on it</span><br><span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span><br>  <span class="token comment">/// Controller for the stream output</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> StreamController<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reference to the stream to update the UI</span><br>  Stream<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Emit a new event to rebuild the UI</span><br>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CanvasController val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Stop the stream and finish</span><br>  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Start the stream</span><br>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// -- Canvas Objects --</span><br><br>  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current Objects on the canvas</span><br>  List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">&gt;</span> _objects<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Remove an object from the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span><br>  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token function">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Raw events from keys pressed</span><br>  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> RawKeyEvent key<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called every time a new finger touches the screen</span><br>  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when any of the fingers update position</span><br>  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when a finger is removed from the screen</span><br>  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span><br>  bool shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Scale of the canvas</span><br>  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">&gt;</span> _scale<span class="token punctuation">;</span><br>  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Max possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br>  <span class="token comment">/// Min possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span><br>  <span class="token comment">/// How much to scale the canvas in increments</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current offset of the canvas</span><br>  Offset <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">&gt;</span> _offset<span class="token punctuation">;</span><br>  Offset _offset <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span>Offset value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Update the home screen with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Listener</span><span class="token punctuation">(</span><br>              behavior<span class="token punctuation">:</span> HitTestBehavior<span class="token punctuation">.</span>opaque<span class="token punctuation">,</span><br>              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                  GestureBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver<br>                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span><br>                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              child<span class="token punctuation">:</span> <span class="token function">RawKeyboardListener</span><span class="token punctuation">(</span><br>                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span><br>                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>                  children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span><br>                      <span class="token function">Positioned</span><span class="token punctuation">(</span><br>                        top<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dy<span class="token punctuation">,</span><br>                        left<span class="token punctuation">:</span> object<span class="token punctuation">.</span>dx<span class="token punctuation">,</span><br>                        width<span class="token punctuation">:</span> object<span class="token punctuation">.</span>width<span class="token punctuation">,</span><br>                        height<span class="token punctuation">:</span> object<span class="token punctuation">.</span>height<span class="token punctuation">,</span><br>                        child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                      <span class="token punctuation">)</span><br>                  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>All we are doing now is just mapping the inputs of the UI to the actions in the controller. Feel free to look through the comments if you are curious how each one works. Running the application should still just show the red square.</p><h2 id="part-5---canvas-offset-and-scale">Part 5 - Canvas Offset and Scale <a href="#part-5---canvas-offset-and-scale" class="direct-link">#</a></h2><p>Now we want to start moving the canvas. Let’s first tackle the offset as scale will take a different approach. Update the home screen with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Listener</span><span class="token punctuation">(</span><br>              behavior<span class="token punctuation">:</span> HitTestBehavior<span class="token punctuation">.</span>opaque<span class="token punctuation">,</span><br>              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                  GestureBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver<br>                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span><br>                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              child<span class="token punctuation">:</span> <span class="token function">RawKeyboardListener</span><span class="token punctuation">(</span><br>                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span><br>                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><br>                  child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span><br>                        AnimatedPositioned<span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span><br>                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span><br>                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span><br>                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          child<span class="token punctuation">:</span> <span class="token function">FittedBox</span><span class="token punctuation">(</span><br>                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span><br>                            child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span><br>                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span><br>                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                        <span class="token punctuation">)</span><br>                    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> RectUtils <span class="token keyword">on</span> Rect <span class="token punctuation">{</span><br>  Rect <span class="token function">adjusted</span><span class="token punctuation">(</span>Offset offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Now when you use your trackpad to pan with two fingers you will see the red square move. We now need to add finger support too. You may notice the FittedBox and that will come in as soon as we add scaling.</p><p>Now if we move the square off the screen we may need to bring it back. We can add a reset button to the AppBar. Add the following to the canvas controller:</p><pre class="language-dart"><code class="language-dart">  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> Offset _offsetDefault <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br><br>  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span><br>    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></code></pre><p>Update the home screen with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><br>              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                  tooltip<span class="token punctuation">:</span> <span class="token string">'Reset the Scale and Offset'</span><span class="token punctuation">,</span><br>                  icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Listener</span><span class="token punctuation">(</span><br>              behavior<span class="token punctuation">:</span> HitTestBehavior<span class="token punctuation">.</span>opaque<span class="token punctuation">,</span><br>              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                  GestureBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver<br>                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span><br>                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              child<span class="token punctuation">:</span> <span class="token function">RawKeyboardListener</span><span class="token punctuation">(</span><br>                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span><br>                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><br>                  child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span><br>                        AnimatedPositioned<span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span><br>                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span><br>                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span><br>                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          child<span class="token punctuation">:</span> <span class="token function">FittedBox</span><span class="token punctuation">(</span><br>                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span><br>                            child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span><br>                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span><br>                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                        <span class="token punctuation">)</span><br>                    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> RectUtils <span class="token keyword">on</span> Rect <span class="token punctuation">{</span><br>  Rect <span class="token function">adjusted</span><span class="token punctuation">(</span>Offset offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Now when you press the reset button the canvas animates back to the default offset and scale.</p><p>While we are here we can add actions for zoom in/out and connect them to the controller. Add the following to the canvas controller:</p><pre class="language-dart"><code class="language-dart">  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br></code></pre><p>Add the following to the AppBar actions:</p><pre class="language-dart"><code class="language-dart">				  <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                  tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom In'</span><span class="token punctuation">,</span><br>                  icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                  tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom Out'</span><span class="token punctuation">,</span><br>                  icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                  onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br></code></pre><p>Now when you run the application you can easily zoom in/out.</p><h2 id="part-6---keyboard-shortcuts">Part 6 - Keyboard Shortcuts <a href="#part-6---keyboard-shortcuts" class="direct-link">#</a></h2><p>Now we need to capture the keyboard events so we can move the canvas with the arrow keys and scale with +/- keys. Update the controller with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/services.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><br><span class="token comment">/// Control the canvas and the objects on it</span><br><span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span><br>  <span class="token comment">/// Controller for the stream output</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> StreamController<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reference to the stream to update the UI</span><br>  Stream<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Emit a new event to rebuild the UI</span><br>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CanvasController val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Stop the stream and finish</span><br>  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Start the stream</span><br>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// -- Canvas Objects --</span><br><br>  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current Objects on the canvas</span><br>  List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">&gt;</span> _objects<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Remove an object from the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span><br>  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token function">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Raw events from keys pressed</span><br>  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> RawKeyEvent key<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Scale keys</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>minus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>equal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Directional Keys</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowLeft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowRight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowDown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span>offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    _shiftPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isShiftPressed<span class="token punctuation">;</span><br><br>    <span class="token comment">/// Update Controller Instance</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called every time a new finger touches the screen</span><br>  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when any of the fingers update position</span><br>  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when a finger is removed from the screen</span><br>  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><br><br>  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span><br>  bool <span class="token keyword">get</span> shiftPressed <span class="token operator">=</span><span class="token operator">&gt;</span> _shiftPressed<span class="token punctuation">;</span><br>  bool _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Scale of the canvas</span><br>  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">&gt;</span> _scale<span class="token punctuation">;</span><br>  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Max possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Min possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// How much to scale the canvas in increments</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// How much to shift the canvas in increments</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double offsetAdjust <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current offset of the canvas</span><br>  Offset <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">&gt;</span> _offset<span class="token punctuation">;</span><br>  Offset _offset <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span>Offset value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> Offset _offsetDefault <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reset the canvas zoom and offset</span><br>  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span><br>    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Zoom in the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Zoom out the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Now when you run the application you can control the zoom and pan with just a keyboard. This could be useful for a fallback input that would work on a TV for example…</p><p>If you want to see if it is actually scaling proportionally then add the following the home screen:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><br>              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom In'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom Out'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Reset the Scale and Offset'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Listener</span><span class="token punctuation">(</span><br>              behavior<span class="token punctuation">:</span> HitTestBehavior<span class="token punctuation">.</span>opaque<span class="token punctuation">,</span><br>              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                  GestureBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver<br>                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span><br>                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              child<span class="token punctuation">:</span> <span class="token function">RawKeyboardListener</span><span class="token punctuation">(</span><br>                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span><br>                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><br>                  child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> object <span class="token keyword">in</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">)</span><br>                        AnimatedPositioned<span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span><br>                          duration<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          rect<span class="token punctuation">:</span> object<span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span><br>                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span><br>                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          child<span class="token punctuation">:</span> <span class="token function">FittedBox</span><span class="token punctuation">(</span><br>                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span><br>                            child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span><br>                              size<span class="token punctuation">:</span> object<span class="token punctuation">.</span>size<span class="token punctuation">,</span><br>                              child<span class="token punctuation">:</span> object<span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                        <span class="token punctuation">)</span><br>                    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> RectUtils <span class="token keyword">on</span> Rect <span class="token punctuation">{</span><br>  Rect <span class="token function">adjusted</span><span class="token punctuation">(</span>Offset offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br></code></pre><p>You can zoom and the blocks all scale correctly and pan around.</p><p>Just press the reset button to start over.</p><h2 id="part-7---multi-touch-input">Part 7 - Multi Touch Input <a href="#part-7---multi-touch-input" class="direct-link">#</a></h2><p>Now time for the fingers. For this you will need a touchscreen device to test. You can plug in your phone or if you have a touch screen computer you can run the web version. Update the controller with following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:async'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'dart:math'</span> <span class="token operator">as</span> math<span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/services.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../classes/rect_points.dart'</span><span class="token punctuation">;</span><br><br><span class="token comment">/// Control the canvas and the objects on it</span><br><span class="token keyword">class</span> <span class="token class-name">CanvasController</span> <span class="token punctuation">{</span><br>  <span class="token comment">/// Controller for the stream output</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> StreamController<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reference to the stream to update the UI</span><br>  Stream<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span> <span class="token keyword">get</span> stream <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Emit a new event to rebuild the UI</span><br>  <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">[</span>CanvasController val<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>val <span class="token operator">?</span><span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Stop the stream and finish</span><br>  <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    focusNode<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Start the stream</span><br>  <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// -- Canvas Objects --</span><br><br>  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> _objects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current Objects on the canvas</span><br>  List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> <span class="token keyword">get</span> objects <span class="token operator">=</span><span class="token operator">&gt;</span> _objects<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">addObject</span><span class="token punctuation">(</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Add an object to the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">updateObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">,</span> CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Remove an object from the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">removeObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Focus node for listening for keyboard shortcuts</span><br>  <span class="token keyword">final</span> focusNode <span class="token operator">=</span> <span class="token function">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Raw events from keys pressed</span><br>  <span class="token keyword">void</span> <span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> RawKeyEvent key<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// Scale keys</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>minus<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>equal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token comment">// Directional Keys</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowLeft<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowRight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetAdjust<span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowUp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">isKeyPressed</span><span class="token punctuation">(</span>LogicalKeyboardKey<span class="token punctuation">.</span>arrowDown<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token operator">-</span>offsetAdjust<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    _shiftPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isShiftPressed<span class="token punctuation">;</span><br>    _metaPressed <span class="token operator">=</span> key<span class="token punctuation">.</span>isMetaPressed<span class="token punctuation">;</span><br><br>    <span class="token comment">/// Update Controller Instance</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Trigger Shift Press</span><br>  <span class="token keyword">void</span> <span class="token function">shiftSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _shiftPressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Trigger Meta Press</span><br>  <span class="token keyword">void</span> <span class="token function">metaSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _metaPressed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">final</span> Map<span class="token operator">&lt;</span>int<span class="token punctuation">,</span> Offset<span class="token operator">&gt;</span> _pointerMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Number of inputs currently on the screen</span><br>  int <span class="token keyword">get</span> touchCount <span class="token operator">=</span><span class="token operator">&gt;</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>length<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Marquee selection on the canvas</span><br>  RectPoints <span class="token keyword">get</span> marquee <span class="token operator">=</span><span class="token operator">&gt;</span> _marquee<span class="token punctuation">;</span><br>  RectPoints _marquee<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Dragging a canvas object</span><br>  bool <span class="token keyword">get</span> isMovingCanvasObject <span class="token operator">=</span><span class="token operator">&gt;</span> _isMovingCanvasObject<span class="token punctuation">;</span><br>  bool _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>int<span class="token operator">&gt;</span> _selectedObjects <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  List<span class="token operator">&lt;</span>int<span class="token operator">&gt;</span> <span class="token keyword">get</span> selectedObjectsIndices <span class="token operator">=</span><span class="token operator">&gt;</span> _selectedObjects<span class="token punctuation">;</span><br>  List<span class="token operator">&lt;</span>CanvasObject<span class="token operator">&lt;</span>Widget<span class="token operator">&gt;&gt;</span> <span class="token keyword">get</span> selectedObjects <span class="token operator">=</span><span class="token operator">&gt;</span><br>      _selectedObjects<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  bool <span class="token function">isObjectSelected</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _selectedObjects<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Called every time a new input touches the screen</span><br>  <span class="token keyword">void</span> <span class="token function">addTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">final</span> pt <span class="token operator">=</span> <span class="token punctuation">(</span>offsetVal <span class="token operator">/</span> scale<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      _marquee <span class="token operator">=</span> <span class="token function">RectPoints</span><span class="token punctuation">(</span>pt<span class="token punctuation">,</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">/// Update Controller Instance</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when any of the inputs update position</span><br>  <span class="token keyword">void</span> <span class="token function">updateTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">,</span> Offset offsetVal<span class="token punctuation">,</span> Offset globalVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Update New Widget Rect</span><br>      <span class="token keyword">final</span> _pts <span class="token operator">=</span> _marquee<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> a <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span><br>      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> b <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> delta <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> scale<span class="token punctuation">;</span><br>      _pts<span class="token punctuation">.</span>end <span class="token operator">=</span> _pts<span class="token punctuation">.</span>end <span class="token operator">+</span> delta<span class="token punctuation">;</span><br>      _marquee <span class="token operator">=</span> _pts<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _rect <span class="token operator">=</span> Rect<span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>_pts<span class="token punctuation">.</span>start<span class="token punctuation">,</span> _pts<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      _selectedObjects<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>_rect<span class="token punctuation">.</span><span class="token function">overlaps</span><span class="token punctuation">(</span>_objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rect<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          _selectedObjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Widget Move</span><br>      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><br>      <span class="token keyword">final</span> a <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span><br>      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> b <span class="token operator">=</span> _pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span>first<span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>_selectedObjects<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><br>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> idx <span class="token keyword">in</span> _selectedObjects<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">final</span> widget <span class="token operator">=</span> _objects<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span><br>        <span class="token keyword">final</span> delta <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> a<span class="token punctuation">)</span> <span class="token operator">/</span> scale<span class="token punctuation">;</span><br>        <span class="token keyword">final</span> _newOffset <span class="token operator">=</span> widget<span class="token punctuation">.</span>offset <span class="token operator">+</span> delta<span class="token punctuation">;</span><br>        _objects<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token operator">=</span> widget<span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span>dx<span class="token punctuation">:</span> _newOffset<span class="token punctuation">.</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">:</span> _newOffset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Scale and Rotate Update</span><br>      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _rectA <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _rectB <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _delta <span class="token operator">=</span> _rectB<span class="token punctuation">.</span>center <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>center<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _newOffset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token punctuation">(</span>_delta <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      offset <span class="token operator">=</span> _newOffset<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> aDistance <span class="token operator">=</span> <span class="token punctuation">(</span>_rectA<span class="token punctuation">.</span>topLeft <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>bottomRight<span class="token punctuation">)</span><span class="token punctuation">.</span>distance<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> bDistance <span class="token operator">=</span> <span class="token punctuation">(</span>_rectB<span class="token punctuation">.</span>topLeft <span class="token operator">-</span> _rectB<span class="token punctuation">.</span>bottomRight<span class="token punctuation">)</span><span class="token punctuation">.</span>distance<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> change <span class="token operator">=</span> <span class="token punctuation">(</span>bDistance <span class="token operator">/</span> aDistance<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      scale <span class="token operator">=</span> scale <span class="token operator">*</span> change<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      <span class="token comment">// Pan Update</span><br>      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _rectA <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _rectB <span class="token operator">=</span> <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>_pointerMap<span class="token punctuation">.</span>values<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token keyword">final</span> _delta <span class="token operator">=</span> _rectB<span class="token punctuation">.</span>center <span class="token operator">-</span> _rectA<span class="token punctuation">.</span>center<span class="token punctuation">;</span><br>      offset <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token punctuation">(</span>_delta <span class="token operator">/</span> scale<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    _pointerMap<span class="token punctuation">[</span>pointer<span class="token punctuation">]</span> <span class="token operator">=</span> offsetVal<span class="token punctuation">;</span><br><br>    <span class="token comment">/// Update Controller Instance</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Called when a input is removed from the screen</span><br>  <span class="token keyword">void</span> <span class="token function">removeTouch</span><span class="token punctuation">(</span>int pointer<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _pointerMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>touchCount <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      _isMovingCanvasObject <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      _marquee <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>      _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">/// Update Controller Instance</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">selectObject</span><span class="token punctuation">(</span>int i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_metaPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          _selectedObjects<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        _selectedObjects<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token keyword">final</span> item <span class="token operator">=</span> _objects<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        _objects<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Checks if the shift key on the keyboard is pressed</span><br>  bool <span class="token keyword">get</span> shiftPressed <span class="token operator">=</span><span class="token operator">&gt;</span> _shiftPressed<span class="token punctuation">;</span><br>  bool _shiftPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Checks if the meta key on the keyboard is pressed</span><br>  bool <span class="token keyword">get</span> metaPressed <span class="token operator">=</span><span class="token operator">&gt;</span> _metaPressed<span class="token punctuation">;</span><br>  bool _metaPressed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Scale of the canvas</span><br>  double <span class="token keyword">get</span> scale <span class="token operator">=</span><span class="token operator">&gt;</span> _scale<span class="token punctuation">;</span><br>  double _scale <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">scale</span><span class="token punctuation">(</span>double value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&lt;=</span> minScale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          value <span class="token operator">=</span> minScale<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;=</span> maxScale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          value <span class="token operator">=</span> maxScale<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>        _scale <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Max possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double maxScale <span class="token operator">=</span> <span class="token number">3.0</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Min possible scale</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double minScale <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// How much to scale the canvas in increments</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double scaleAdjust <span class="token operator">=</span> <span class="token number">0.05</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// How much to shift the canvas in increments</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double offsetAdjust <span class="token operator">=</span> <span class="token number">15</span><span class="token punctuation">;</span><br><br>  <span class="token comment">/// Current offset of the canvas</span><br>  Offset <span class="token keyword">get</span> offset <span class="token operator">=</span><span class="token operator">&gt;</span> _offset<span class="token punctuation">;</span><br>  Offset _offset <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br>  <span class="token keyword">set</span> <span class="token function">offset</span><span class="token punctuation">(</span>Offset value<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        _offset <span class="token operator">=</span> value<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> double _scaleDefault <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><br>  <span class="token keyword">static</span> <span class="token keyword">const</span> Offset _offsetDefault <span class="token operator">=</span> Offset<span class="token punctuation">.</span>zero<span class="token punctuation">;</span><br><br>  <span class="token comment">/// Reset the canvas zoom and offset</span><br>  <span class="token keyword">void</span> <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">=</span> _scaleDefault<span class="token punctuation">;</span><br>    offset <span class="token operator">=</span> _offsetDefault<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Zoom in the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">zoomIn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">+=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token comment">/// Zoom out the canvas</span><br>  <span class="token keyword">void</span> <span class="token function">zoomOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    scale <span class="token operator">-=</span> scaleAdjust<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_update</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  Rect <span class="token function">_getRectFromPoints</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>Offset<span class="token operator">&gt;</span> offsets<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>offsets<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>offsets<span class="token punctuation">.</span>first<span class="token punctuation">,</span> offsets<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">final</span> dxs <span class="token operator">=</span> offsets<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>dx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">final</span> dys <span class="token operator">=</span> offsets<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> e<span class="token punctuation">.</span>dy<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    double left <span class="token operator">=</span> <span class="token function">_minFromList</span><span class="token punctuation">(</span>dxs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    double top <span class="token operator">=</span> <span class="token function">_minFromList</span><span class="token punctuation">(</span>dys<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    double bottom <span class="token operator">=</span> <span class="token function">_maxFromList</span><span class="token punctuation">(</span>dys<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    double right <span class="token operator">=</span> <span class="token function">_maxFromList</span><span class="token punctuation">(</span>dxs<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  double <span class="token function">_minFromList</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>double<span class="token operator">&gt;</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    double value <span class="token operator">=</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> value<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  double <span class="token function">_maxFromList</span><span class="token punctuation">(</span>List<span class="token operator">&lt;</span>double<span class="token operator">&gt;</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    double value <span class="token operator">=</span> <span class="token operator">-</span>double<span class="token punctuation">.</span>infinity<span class="token punctuation">;</span><br>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">final</span> item <span class="token keyword">in</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> value<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Add a new file <code>src/classes/rect_points.dart</code> and add the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:ui'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">RectPoints</span> <span class="token punctuation">{</span><br>  <span class="token function">RectPoints</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  Offset start<span class="token punctuation">,</span> end<span class="token punctuation">;</span><br><br>  Rect <span class="token keyword">get</span> rect <span class="token operator">=</span><span class="token operator">&gt;</span> Rect<span class="token punctuation">.</span><span class="token function">fromPoints</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br></code></pre><p>Update the <code>main.dart</code> with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'ui/home/screen.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span><br>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Demo'</span><span class="token punctuation">,</span><br>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span><br>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span><br>        accentColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span><br>        visualDensity<span class="token punctuation">:</span> VisualDensity<span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>      darkTheme<span class="token punctuation">:</span> ThemeData<span class="token punctuation">.</span><span class="token function">dark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copyWith</span><span class="token punctuation">(</span><br>        visualDensity<span class="token punctuation">:</span> VisualDensity<span class="token punctuation">.</span>adaptivePlatformDensity<span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>      home<span class="token punctuation">:</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Update the home screen with the following:</p><pre class="language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/gestures.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token string">'../../src/classes/canvas_object.dart'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token string">'../../src/controllers/canvas.dart'</span><span class="token punctuation">;</span><br><br><span class="token keyword">class</span> <span class="token class-name">HomeScreen</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> <span class="token function">HomeScreen</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  _HomeScreenState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_HomeScreenState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">class</span> <span class="token class-name">_HomeScreenState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>HomeScreen<span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  <span class="token keyword">final</span> _controller <span class="token operator">=</span> <span class="token function">CanvasController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">void</span> <span class="token function">_dummyData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>    _controller<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><br>      <span class="token function">CanvasObject</span><span class="token punctuation">(</span><br>        dx<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        dy<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span><br>        width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span><br>        height<span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span><br>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    _controller<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token metadata symbol">@override</span><br>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> StreamBuilder<span class="token operator">&lt;</span>CanvasController<span class="token operator">&gt;</span><span class="token punctuation">(</span><br>        stream<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>stream<span class="token punctuation">,</span><br>        builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>snapshot<span class="token punctuation">.</span>hasData<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>              appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>              body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">;</span><br>          <span class="token punctuation">}</span><br>          <span class="token keyword">final</span> instance <span class="token operator">=</span> snapshot<span class="token punctuation">.</span>data<span class="token punctuation">;</span><br>          <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span><br>            appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><br>              actions<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Selection'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>select_all<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>shiftPressed<br>                        <span class="token operator">?</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>accentColor<br>                        <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>shiftSelect<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Meta Key'</span><span class="token punctuation">,</span><br>                    color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>metaPressed<br>                        <span class="token operator">?</span> Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>accentColor<br>                        <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>category<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>metaSelect<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom In'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_in<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomIn<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Zoom Out'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>zoom_out<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>zoomOut<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token function">FocusScope</span><span class="token punctuation">(</span><br>                  canRequestFocus<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><br>                  child<span class="token punctuation">:</span> <span class="token function">IconButton</span><span class="token punctuation">(</span><br>                    tooltip<span class="token punctuation">:</span> <span class="token string">'Reset the Scale and Offset'</span><span class="token punctuation">,</span><br>                    icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>restore<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    onPressed<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>reset<span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">]</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            body<span class="token punctuation">:</span> <span class="token function">Listener</span><span class="token punctuation">(</span><br>              behavior<span class="token punctuation">:</span> HitTestBehavior<span class="token punctuation">.</span>opaque<span class="token punctuation">,</span><br>              onPointerSignal<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>details <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                  GestureBinding<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>pointerSignalResolver<br>                      <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>event <span class="token operator">is</span> PointerScrollEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>_controller<span class="token punctuation">.</span>shiftPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                        double zoomDelta <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">.</span>dy <span class="token operator">/</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                        _controller<span class="token punctuation">.</span>scale <span class="token operator">=</span> _controller<span class="token punctuation">.</span>scale <span class="token operator">+</span> zoomDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                        _controller<span class="token punctuation">.</span>offset <span class="token operator">=</span><br>                            _controller<span class="token punctuation">.</span>offset <span class="token operator">-</span> event<span class="token punctuation">.</span>scrollDelta<span class="token punctuation">;</span><br>                      <span class="token punctuation">}</span><br>                    <span class="token punctuation">}</span><br>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>                <span class="token punctuation">}</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerMove<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">updateTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">addTouch</span><span class="token punctuation">(</span><br>                  details<span class="token punctuation">.</span>pointer<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>localPosition<span class="token punctuation">,</span><br>                  details<span class="token punctuation">.</span>position<span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerUp<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              onPointerCancel<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                _controller<span class="token punctuation">.</span><span class="token function">removeTouch</span><span class="token punctuation">(</span>details<span class="token punctuation">.</span>pointer<span class="token punctuation">)</span><span class="token punctuation">;</span><br>              <span class="token punctuation">}</span><span class="token punctuation">,</span><br>              child<span class="token punctuation">:</span> <span class="token function">RawKeyboardListener</span><span class="token punctuation">(</span><br>                autofocus<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>                focusNode<span class="token punctuation">:</span> _controller<span class="token punctuation">.</span>focusNode<span class="token punctuation">,</span><br>                onKey<span class="token punctuation">:</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">rawKeyEvent</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><br>                  child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span><br>                    children<span class="token punctuation">:</span> <span class="token punctuation">[</span><br>                      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><br>                        Positioned<span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span><br>                          rect<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>rect<span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span><br>                            _controller<span class="token punctuation">.</span>offset<span class="token punctuation">,</span><br>                            _controller<span class="token punctuation">.</span>scale<span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><br>                            decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span><br>                                border<span class="token punctuation">:</span> Border<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><br>                              color<span class="token punctuation">:</span> instance<span class="token punctuation">.</span><span class="token function">isObjectSelected</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><br>                                  <span class="token operator">?</span> Colors<span class="token punctuation">.</span>grey<br>                                  <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>transparent<span class="token punctuation">,</span><br>                            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                            child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span><br>                              onTapDown<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> _controller<span class="token punctuation">.</span><span class="token function">selectObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                              child<span class="token punctuation">:</span> <span class="token function">FittedBox</span><span class="token punctuation">(</span><br>                                fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fill<span class="token punctuation">,</span><br>                                child<span class="token punctuation">:</span> SizedBox<span class="token punctuation">.</span><span class="token function">fromSize</span><span class="token punctuation">(</span><br>                                  size<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>size<span class="token punctuation">,</span><br>                                  child<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>objects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>child<span class="token punctuation">,</span><br>                                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>instance<span class="token operator">?</span><span class="token punctuation">.</span>marquee <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><br>                        Positioned<span class="token punctuation">.</span><span class="token function">fromRect</span><span class="token punctuation">(</span><br>                          rect<span class="token punctuation">:</span> instance<span class="token punctuation">.</span>marquee<span class="token punctuation">.</span>rect<br>                              <span class="token punctuation">.</span><span class="token function">adjusted</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>offset<span class="token punctuation">,</span> instance<span class="token punctuation">.</span>scale<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><br>                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueAccent<span class="token punctuation">.</span><span class="token function">withOpacity</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                          <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token punctuation">]</span><span class="token punctuation">,</span><br>                  <span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">)</span><span class="token punctuation">,</span><br>              <span class="token punctuation">)</span><span class="token punctuation">,</span><br>            <span class="token punctuation">)</span><span class="token punctuation">,</span><br>          <span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> RectUtils <span class="token keyword">on</span> Rect <span class="token punctuation">{</span><br>  Rect <span class="token function">adjusted</span><span class="token punctuation">(</span>Offset offset<span class="token punctuation">,</span> double scale<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">final</span> left <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>left <span class="token operator">+</span> offset<span class="token punctuation">.</span>dx<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> top <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>top <span class="token operator">+</span> offset<span class="token punctuation">.</span>dy<span class="token punctuation">)</span> <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> width <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">final</span> height <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">*</span> scale<span class="token punctuation">;</span><br>    <span class="token keyword">return</span> Rect<span class="token punctuation">.</span><span class="token function">fromLTWH</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre><p>Now you can move any object on the canvas just by clicking and dragging. You can zoom with 2 fingers and pan with 2 or 3 fingers. If you hold down the shift key then you can use a marquee to select multiple and if you hold down the meta/command key then you can select multiple by tapping each.</p><h2 id="conclusion">Conclusion <a href="#conclusion" class="direct-link">#</a></h2><p>If you are on a device without a keyboard you can tap the new icons to turn on the keyboard key actions. When the object is selected there is a grey border.</p><p>Now you can add any widget to the canvas and pan and zoom!</p><h1>🙏🙏🙏</h1><p>Since you've made it this far, <a href="https://rodydavis.com/posts/flutter-multi-touch-canvas/" on-click="share">sharing</a> this article on your favorite social media network would be highly appreciated 💖! For feedback, please <a href="https://twitter.com/rodydavis" rel="noopener" target="_blank">ping me on Twitter.</a></p><share-widget><button aria-label="Share" href="https://rodydavis.com/posts/flutter-multi-touch-canvas/" on-click="share"><div></div></button></share-widget><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Multi-touch Canvas with Flutter",
  "image": [],
  "author": "Rody Davis", 
  "genre": "https://schema.org/Code", 
  "publisher": {
    "@type": "Organization",
    "name": "Rody Davis",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=2089033c93"
    }
  },
  "url": "https://rodydavis.com/posts/flutter-multi-touch-canvas/",
  "mainEntityOfPage": "https://rodydavis.com/posts/flutter-multi-touch-canvas/",
  "datePublished": "2020-06-10",
  "dateModified": "2021-05-07",
  "description": "If you ever wanted to create a canvas in Flutter that needs to be panned in any direction and allow zoom then you also probably tried to..."
}</script><p>Published <time datetime="2020-06-10">10 Jun 2020</time></p></article></main><footer><a href="/about/">Rody Davis</a></footer></body></html>