<!DOCTYPE html>
<html lang="en" class="astro-MDYSN4OI">
  <head>
    <!-- Global Metadata --><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<meta name="generator" content="Astro v2.0.4">

<!-- Canonical URL -->
<link rel="canonical" href="https://rodydavis.com/posts/flutter-multi-touch-canvas/">

<!-- Primary Meta Tags -->
<title>Multi-touch Canvas with Flutter</title>
<meta name="title" content="Multi-touch Canvas with Flutter">
<meta name="description">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://rodydavis.com/posts/flutter-multi-touch-canvas/">
<meta property="og:title" content="Multi-touch Canvas with Flutter">
<meta property="og:description">
<meta property="og:image" content="https://rodydavis.com/placeholder-social.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://rodydavis.com/posts/flutter-multi-touch-canvas/">
<meta property="twitter:title" content="Multi-touch Canvas with Flutter">
<meta property="twitter:description">
<meta property="twitter:image" content="https://rodydavis.com/placeholder-social.jpg">

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JQNPVBL9DR"></script>

    
  <link rel="stylesheet" href="/_astro/_...slug_.f65ef62a.css" />
<link rel="stylesheet" href="/_astro/_...slug_.7a06253d.css" /><script type="module">window.dataLayer=window.dataLayer||[];function a(){dataLayer.push(arguments)}a("js",new Date);a("config","G-JQNPVBL9DR");
</script></head>

  <body class="markdown-body astro-MDYSN4OI">
    <header class="astro-3EF6KSR2">
  <h2 class="astro-3EF6KSR2">
    <a href="/" class="astro-3EF6KSR2">Rody Davis</a>
  </h2>
  <nav class="astro-3EF6KSR2">
    <a href="/search?tags=app" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Apps</div>
</a><a href="/search?tags=posts" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Blog</div>
</a><a href="/talks" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> Talks</div>
</a><a href="/about" class="astro-3EF6KSR2 astro-EIMMU3LG" style="display:flex;flex-direction:row;align-items:center">
  
  <div class="astro-EIMMU3LG"> About</div>
</a>
  </nav>
</header>
    <main class="astro-MDYSN4OI">
      <style>
	@media (min-width: 860px) {
		main {
			display: flex;
			flex-direction: row;
			justify-content: space-between;
		}
		article {
			flex: 1;
		}
		aside {
			display: block;
			position: sticky;
			top: 0;
			right: 0;
			max-height: 100vh;
			overflow-y: auto;
		}
	}
	</style><main class="astro-BVZIHDZO">
    <article class="astro-BVZIHDZO">
      
      <h1 class="title astro-BVZIHDZO">Multi-touch Canvas with Flutter</h1>
      
      
      <hr class="astro-BVZIHDZO">
      <p>If you ever wanted to create a canvas in <a href="https://flutter.dev">Flutter</a> that needs to be panned in any direction and allow zoom then you also probably tried to create a <a href="https://api.flutter.dev/flutter/gestures/MultiDragGestureRecognizer-class.html">MultiGestureRecognizer</a> or under a <a href="https://api.flutter.dev/flutter/widgets/GestureDetector-class.html">GestureDetector</a> added onPanUpdate and onScaleUpdate and received an error because both can not work at the same time. Even if you have to GestureDetectors then you will still find it does not work how you want and one will always win.</p>
<blockquote>
<p><strong>TLDR</strong> The final source <a href="https://github.com/rodydavis/flutter_multi_touch_canvas">here</a> and an online <a href="https://rodydavis.github.io/flutter_multi_touch_canvas/">demo</a>.</p>
</blockquote>
<iframe class="demo" src="https://dartpad.dev/embed-flutter.html?id=e1ead4f4e314691ac8497b004ee679a5&#x26;split=80&#x26;theme=dark&#x26;null_safety=false&#x26;split=50&#x26;ga_id=flutter-multi-touch-canvas&#x26;run=true"></iframe>
<p>This is the canvas rendering logic used in <a href="https://widget.studio">https://widget.studio</a></p>
<h2 id=""><a aria-hidden="true" tabindex="-1" href="#"><span class="icon icon-link"></span></a>Multi Touch Goal</h2>
<ul>
<li>Pan the canvas with two or more fingers</li>
<li>Zoom the canvas with two fingers only (Pinch/Zoom)</li>
<li>Single finger will interact with canvas object and detect selection</li>
<li>Bonus trackpad support with similar results</li>
</ul>
<p>In order to achieve this we need to use a Listener for the trackpad events and raw touch interactions and  <a href="https://api.flutter.dev/flutter/widgets/RawKeyboardListener-class.html">RawKeyboardListener</a> for keyboard shortcuts.</p>
<h2 id="-1"><a aria-hidden="true" tabindex="-1" href="#-1"><span class="icon icon-link"></span></a>Part 1 - Project Setup</h2>
<p>Open your terminal and type the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">mkdir flutter_multi_touch</span></span>
<span class="line"><span style="color: #79C0FF">cd</span><span style="color: #C9D1D9"> flutter_multi_touch</span></span>
<span class="line"><span style="color: #C9D1D9">flutter create </span><span style="color: #79C0FF">.</span></span>
<span class="line"><span style="color: #C9D1D9">code </span><span style="color: #79C0FF">.</span></span></code></pre>
<p>The last line is optional and if you have VSCode installed. The command will open the directory inside VSCode.</p>
<h2 id="-2"><a aria-hidden="true" tabindex="-1" href="#-2"><span class="icon icon-link"></span></a>Part 2 - Boilerplate</h2>
<ul>
<li>Remove all comments</li>
<li>Remove extra empty lines</li>
<li>Update UI</li>
</ul>
<p>Right now when you run the project you will have this UI.</p>
<p>Create a new file located at <code>ui/home/screen.dart</code> and add the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatelessWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Update <code>main.dart</code> with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'ui/home/screen.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">main</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">runApp</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">MyApp</span><span style="color: #C9D1D9">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MyApp</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatelessWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MaterialApp</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      debugShowCheckedModeBanner</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      title</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Flutter Demo'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      theme</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ThemeData</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        primarySwatch</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.blue,</span></span>
<span class="line"><span style="color: #C9D1D9">        visualDensity</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">VisualDensity</span><span style="color: #C9D1D9">.adaptivePlatformDensity,</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">      darkTheme</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ThemeData</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dark</span><span style="color: #C9D1D9">().</span><span style="color: #D2A8FF">copyWith</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        visualDensity</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">VisualDensity</span><span style="color: #C9D1D9">.adaptivePlatformDensity,</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">      home</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>You will now have a black screen when you run the application.</p>
<h2 id="-3"><a aria-hidden="true" tabindex="-1" href="#-3"><span class="icon icon-link"></span></a>Part 3 - Creating the Controller</h2>
<p>Now we want to create a class that will act as our controller on the canvas.
Create a new file at <code>src/controllers/canvas.dart</code> and add the following to start:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// Control the canvas and the objects on it</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// Controller for the stream output</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// Reference to the stream to update the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// Emit a new event to rebuild the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> val]) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// Stop the stream and finish</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">	</span><span style="color: #8B949E">// Start the stream</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Update the home screen with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">Positioned</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  top</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  left</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">                )</span></span>
<span class="line"><span style="color: #C9D1D9">              ],</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Here we are just adding the basics to rebuild when the controller changes or the screen is finished. We are using a stateful widget here because we want to dispose of the controller and load it only once. We are also using a stack because thats all we need under the hood. After a quick hot restart you should have the following view.</p>
<h2 id="-4"><a aria-hidden="true" tabindex="-1" href="#-4"><span class="icon icon-link"></span></a>Part 4 - Adding Canvas Objects</h2>
<p>Now we need to create the class for the objects that will be stored on the canvas. Create a new file at <code>src/classes/canvas_object.dart</code> and add the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:ui'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">T</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> dx;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> dy;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> width;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> height;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">T</span><span style="color: #C9D1D9"> child;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.dx </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.dy </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.child,</span></span>
<span class="line"><span style="color: #C9D1D9">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">T</span><span style="color: #C9D1D9">> </span><span style="color: #D2A8FF">copyWith</span><span style="color: #C9D1D9">({</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> dx,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> dy,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> width,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> height,</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">T</span><span style="color: #C9D1D9"> child,</span></span>
<span class="line"><span style="color: #C9D1D9">  }) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">T</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">      dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> dx </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.dx,</span></span>
<span class="line"><span style="color: #C9D1D9">      dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> dy </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.dy,</span></span>
<span class="line"><span style="color: #C9D1D9">      width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> width </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width,</span></span>
<span class="line"><span style="color: #C9D1D9">      height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> height </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height,</span></span>
<span class="line"><span style="color: #C9D1D9">      child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> child </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.child,</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Size</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">size</span><span style="color: #C9D1D9"> => </span><span style="color: #79C0FF">Size</span><span style="color: #C9D1D9">(width, height);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9"> => </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(dx, dy);</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">rect</span><span style="color: #C9D1D9"> => offset </span><span style="color: #FF7B72">&#x26;</span><span style="color: #C9D1D9"> size;</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>We are using a generic here to not depend on flutter or material in the class. Update the controller with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// Control the canvas and the objects on it</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Controller for the stream output</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reference to the stream to update the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Emit a new event to rebuild the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> val]) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Stop the stream and finish</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Start the stream</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// -- Canvas Objects --</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> _objects </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current Objects on the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">objects</span><span style="color: #C9D1D9"> => _objects;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(value);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i, </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects[i] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Remove an object from the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">removeAt</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Function</span><span style="color: #C9D1D9">() action) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">action</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>We are just adding the objects to the canvas and removing them if needed. Update the home screen with the following to use these new objects:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> object </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> instance.objects)</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">Positioned</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    top</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.dy,</span></span>
<span class="line"><span style="color: #C9D1D9">                    left</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.dx,</span></span>
<span class="line"><span style="color: #C9D1D9">                    width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.width,</span></span>
<span class="line"><span style="color: #C9D1D9">                    height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.height,</span></span>
<span class="line"><span style="color: #C9D1D9">                    child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.child,</span></span>
<span class="line"><span style="color: #C9D1D9">                  )</span></span>
<span class="line"><span style="color: #C9D1D9">              ],</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>The UI is thee same as before but now is dynamic and we have access to the Stack children and position of each child.</p>
<h2 id="-5"><a aria-hidden="true" tabindex="-1" href="#-5"><span class="icon icon-link"></span></a>Part 5 - Capture the Input</h2>
<p>We need to capture the input of the MultiGestureRecognizer, GestureDetector and RawKeyboardListener. Update the canvas controller with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// Control the canvas and the objects on it</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Controller for the stream output</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reference to the stream to update the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Emit a new event to rebuild the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> val]) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Stop the stream and finish</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    focusNode.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Start the stream</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// -- Canvas Objects --</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> _objects </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current Objects on the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">objects</span><span style="color: #C9D1D9"> => _objects;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(value);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i, </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects[i] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Remove an object from the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">removeAt</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Focus node for listening for keyboard shortcuts</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> focusNode </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FocusNode</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Raw events from keys pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context, </span><span style="color: #79C0FF">RawKeyEvent</span><span style="color: #C9D1D9"> key) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called every time a new finger touches the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when any of the fingers update position</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when a finger is removed from the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Checks if the shift key on the keyboard is pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Scale of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9"> => _scale;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Max possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> maxScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3.0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Min possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> minScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// How much to scale the canvas in increments</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scaleAdjust </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.05</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current offset of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9"> => _offset;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Function</span><span style="color: #C9D1D9">() action) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">action</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Update the home screen with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Listener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              behavior</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HitTestBehavior</span><span style="color: #C9D1D9">.opaque,</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerSignal</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (details </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">GestureBinding</span><span style="color: #C9D1D9">.instance.pointerSignalResolver</span></span>
<span class="line"><span style="color: #C9D1D9">                      .</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(details, (event) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_controller.shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> zoomDelta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">event.scrollDelta.dy </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">300</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _controller.scale </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> zoomDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.offset </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> event.scrollDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                  });</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerMove</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerUp</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerCancel</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RawKeyboardListener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                autofocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                focusNode</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.focusNode,</span></span>
<span class="line"><span style="color: #C9D1D9">                onKey</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (key) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(context, key),</span></span>
<span class="line"><span style="color: #C9D1D9">                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> object </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> instance.objects)</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #79C0FF">Positioned</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                        top</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.dy,</span></span>
<span class="line"><span style="color: #C9D1D9">                        left</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.dx,</span></span>
<span class="line"><span style="color: #C9D1D9">                        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.width,</span></span>
<span class="line"><span style="color: #C9D1D9">                        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.height,</span></span>
<span class="line"><span style="color: #C9D1D9">                        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.child,</span></span>
<span class="line"><span style="color: #C9D1D9">                      )</span></span>
<span class="line"><span style="color: #C9D1D9">                  ],</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ),</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>All we are doing now is just mapping the inputs of the UI to the actions in the controller. Feel free to look through the comments if you are curious how each one works. Running the application should still just show the red square.</p>
<h2 id="-6"><a aria-hidden="true" tabindex="-1" href="#-6"><span class="icon icon-link"></span></a>Part 5 - Canvas Offset and Scale</h2>
<p>Now we want to start moving the canvas. Lets first tackle the offset as scale will take a different approach. Update the home screen with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Listener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              behavior</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HitTestBehavior</span><span style="color: #C9D1D9">.opaque,</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerSignal</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (details </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">GestureBinding</span><span style="color: #C9D1D9">.instance.pointerSignalResolver</span></span>
<span class="line"><span style="color: #C9D1D9">                      .</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(details, (event) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_controller.shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> zoomDelta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">event.scrollDelta.dy </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">300</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _controller.scale </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> zoomDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.offset </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> event.scrollDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                  });</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerMove</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerUp</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerCancel</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RawKeyboardListener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                autofocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                focusNode</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.focusNode,</span></span>
<span class="line"><span style="color: #C9D1D9">                onKey</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (key) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(context, key),</span></span>
<span class="line"><span style="color: #C9D1D9">                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">expand</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> object </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> instance.objects)</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">AnimatedPositioned</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromRect</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                          duration</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Duration</span><span style="color: #C9D1D9">(milliseconds</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">50</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                          rect</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.rect.</span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset,</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.scale,</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FittedBox</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            fit</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">BoxFit</span><span style="color: #C9D1D9">.fill,</span></span>
<span class="line"><span style="color: #C9D1D9">                            child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromSize</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                              size</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.size,</span></span>
<span class="line"><span style="color: #C9D1D9">                              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.child,</span></span>
<span class="line"><span style="color: #C9D1D9">                            ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                        )</span></span>
<span class="line"><span style="color: #C9D1D9">                    ],</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ),</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">extension</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectUtils</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">on</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offset, </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scale) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> left </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.left </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dx) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> top </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.top </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dy) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> width </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> height </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromLTWH</span><span style="color: #C9D1D9">(left, top, width, height);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Now when you use your trackpad to pan with two fingers you will see the red square move. We now need to add finger support too. You may notice the FittedBox and that will come in as soon as we add scaling.</p>
<p>Now if we move the square off the screen we may need to bring it back. We can add a reset button to the AppBar. Add the following to the canvas controller:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scaleDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offsetDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">reset</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _scaleDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">    offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _offsetDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span></code></pre>
<p>Update the home screen with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              actions</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Reset the Scale and Offset'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.restore),</span></span>
<span class="line"><span style="color: #C9D1D9">                  onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.reset,</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ],</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Listener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              behavior</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HitTestBehavior</span><span style="color: #C9D1D9">.opaque,</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerSignal</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (details </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">GestureBinding</span><span style="color: #C9D1D9">.instance.pointerSignalResolver</span></span>
<span class="line"><span style="color: #C9D1D9">                      .</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(details, (event) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_controller.shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> zoomDelta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">event.scrollDelta.dy </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">300</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _controller.scale </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> zoomDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.offset </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> event.scrollDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                  });</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerMove</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerUp</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerCancel</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RawKeyboardListener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                autofocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                focusNode</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.focusNode,</span></span>
<span class="line"><span style="color: #C9D1D9">                onKey</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (key) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(context, key),</span></span>
<span class="line"><span style="color: #C9D1D9">                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">expand</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> object </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> instance.objects)</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">AnimatedPositioned</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromRect</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                          duration</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Duration</span><span style="color: #C9D1D9">(milliseconds</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">50</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                          rect</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.rect.</span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset,</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.scale,</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FittedBox</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            fit</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">BoxFit</span><span style="color: #C9D1D9">.fill,</span></span>
<span class="line"><span style="color: #C9D1D9">                            child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromSize</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                              size</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.size,</span></span>
<span class="line"><span style="color: #C9D1D9">                              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.child,</span></span>
<span class="line"><span style="color: #C9D1D9">                            ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                        )</span></span>
<span class="line"><span style="color: #C9D1D9">                    ],</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ),</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">extension</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectUtils</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">on</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offset, </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scale) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> left </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.left </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dx) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> top </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.top </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dy) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> width </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> height </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromLTWH</span><span style="color: #C9D1D9">(left, top, width, height);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Now when you press the reset button the canvas animates back to the default offset and scale.</p>
<p>While we are here we can add actions for zoom in/out and connect them to the controller. Add the following to the canvas controller:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomIn</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomOut</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">-=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span></code></pre>
<p>Add the following to the AppBar actions:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #C9D1D9">				  </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom In'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_in),</span></span>
<span class="line"><span style="color: #C9D1D9">                  onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomIn,</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom Out'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_out),</span></span>
<span class="line"><span style="color: #C9D1D9">                  onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomOut,</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"></span></code></pre>
<p>Now when you run the application you can easily zoom in/out.</p>
<h2 id="-7"><a aria-hidden="true" tabindex="-1" href="#-7"><span class="icon icon-link"></span></a>Part 6 - Keyboard Shortcuts</h2>
<p>Now we need to capture the keyboard events so we can move the canvas with the arrow keys and scale with +/- keys. Update the controller with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/services.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// Control the canvas and the objects on it</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Controller for the stream output</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reference to the stream to update the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Emit a new event to rebuild the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> val]) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Stop the stream and finish</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    focusNode.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Start the stream</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// -- Canvas Objects --</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> _objects </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current Objects on the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">objects</span><span style="color: #C9D1D9"> => _objects;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(value);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i, </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects[i] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Remove an object from the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">removeAt</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Focus node for listening for keyboard shortcuts</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> focusNode </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FocusNode</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Raw events from keys pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context, </span><span style="color: #79C0FF">RawKeyEvent</span><span style="color: #C9D1D9"> key) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Scale keys</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.minus)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">zoomOut</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.equal)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">zoomIn</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Directional Keys</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowLeft)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(offsetAdjust, </span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowRight)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">offsetAdjust, </span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowUp)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">, offsetAdjust);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowDown)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">offsetAdjust);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> key.isShiftPressed;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/// Update Controller Instance</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called every time a new finger touches the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when any of the fingers update position</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when a finger is removed from the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer) {}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Checks if the shift key on the keyboard is pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">shiftPressed</span><span style="color: #C9D1D9"> => _shiftPressed;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Scale of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9"> => _scale;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Max possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> maxScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3.0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Min possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> minScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// How much to scale the canvas in increments</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scaleAdjust </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.05</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// How much to shift the canvas in increments</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> offsetAdjust </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">15</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current offset of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9"> => _offset;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scaleDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offsetDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reset the canvas zoom and offset</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">reset</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _scaleDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">    offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _offsetDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Zoom in the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomIn</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Zoom out the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomOut</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">-=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Function</span><span style="color: #C9D1D9">() action) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">action</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Now when you run the application you can control the zoom and pan with just a keyboard. This could be useful for a fallback input that would work on a TV for example</p>
<p>If you want to see if it is actually scaling proportionally then add the following the home screen:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">80</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">60</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">200</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.green),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">40</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">50</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.blue),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              actions</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom In'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_in),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomIn,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom Out'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_out),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomOut,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Reset the Scale and Offset'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.restore),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.reset,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ],</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Listener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              behavior</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HitTestBehavior</span><span style="color: #C9D1D9">.opaque,</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerSignal</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (details </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">GestureBinding</span><span style="color: #C9D1D9">.instance.pointerSignalResolver</span></span>
<span class="line"><span style="color: #C9D1D9">                      .</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(details, (event) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_controller.shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> zoomDelta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">event.scrollDelta.dy </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">300</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _controller.scale </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> zoomDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.offset </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> event.scrollDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                  });</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerMove</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerUp</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerCancel</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RawKeyboardListener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                autofocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                focusNode</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.focusNode,</span></span>
<span class="line"><span style="color: #C9D1D9">                onKey</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (key) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(context, key),</span></span>
<span class="line"><span style="color: #C9D1D9">                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">expand</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> object </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> instance.objects)</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">AnimatedPositioned</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromRect</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                          duration</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Duration</span><span style="color: #C9D1D9">(milliseconds</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">50</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                          rect</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.rect.</span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset,</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.scale,</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FittedBox</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            fit</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">BoxFit</span><span style="color: #C9D1D9">.fill,</span></span>
<span class="line"><span style="color: #C9D1D9">                            child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromSize</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                              size</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.size,</span></span>
<span class="line"><span style="color: #C9D1D9">                              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> object.child,</span></span>
<span class="line"><span style="color: #C9D1D9">                            ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                        )</span></span>
<span class="line"><span style="color: #C9D1D9">                    ],</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ),</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">extension</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectUtils</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">on</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offset, </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scale) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> left </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.left </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dx) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> top </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.top </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dy) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> width </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> height </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromLTWH</span><span style="color: #C9D1D9">(left, top, width, height);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"></span></code></pre>
<p>You can zoom and the blocks all scale correctly and pan around.</p>
<p>Just press the reset button to start over.</p>
<h2 id="-8"><a aria-hidden="true" tabindex="-1" href="#-8"><span class="icon icon-link"></span></a>Part 7 - Multi Touch Input</h2>
<p>Now time for the fingers. For this you will need a touchscreen device to test. You can plug in your phone or if you have a touch screen computer you can run the web version. Update the controller with following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:async'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:math'</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">as</span><span style="color: #C9D1D9"> math;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/services.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../classes/rect_points.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #8B949E">/// Control the canvas and the objects on it</span></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Controller for the stream output</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamController</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reference to the stream to update the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Stream</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">stream</span><span style="color: #C9D1D9"> => _controller.stream;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Emit a new event to rebuild the UI</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">([</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9"> val]) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(val </span><span style="color: #FF7B72">??</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Stop the stream and finish</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    focusNode.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Start the stream</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">// -- Canvas Objects --</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> _objects </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current Objects on the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">objects</span><span style="color: #C9D1D9"> => _objects;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(value);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Add an object to the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i, </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects[i] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Remove an object from the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">removeAt</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Focus node for listening for keyboard shortcuts</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> focusNode </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FocusNode</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Raw events from keys pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context, </span><span style="color: #79C0FF">RawKeyEvent</span><span style="color: #C9D1D9"> key) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Scale keys</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.minus)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">zoomOut</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.equal)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #D2A8FF">zoomIn</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">// Directional Keys</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowLeft)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(offsetAdjust, </span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowRight)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">offsetAdjust, </span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowUp)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">, offsetAdjust);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (key.</span><span style="color: #D2A8FF">isKeyPressed</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">LogicalKeyboardKey</span><span style="color: #C9D1D9">.arrowDown)) {</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0.0</span><span style="color: #C9D1D9">, </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">offsetAdjust);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> key.isShiftPressed;</span></span>
<span class="line"><span style="color: #C9D1D9">    _metaPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> key.isMetaPressed;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/// Update Controller Instance</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Trigger Shift Press</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">shiftSelect</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Trigger Meta Press</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">metaSelect</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _metaPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Map</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">> _pointerMap </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Number of inputs currently on the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">touchCount</span><span style="color: #C9D1D9"> => _pointerMap.values.length;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Marquee selection on the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">RectPoints</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">marquee</span><span style="color: #C9D1D9"> => _marquee;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">RectPoints</span><span style="color: #C9D1D9"> _marquee;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Dragging a canvas object</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">isMovingCanvasObject</span><span style="color: #C9D1D9"> => _isMovingCanvasObject;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> _isMovingCanvasObject </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">> _selectedObjects </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> [];</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9">> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">selectedObjectsIndices</span><span style="color: #C9D1D9"> => _selectedObjects;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9">>> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">selectedObjects</span><span style="color: #C9D1D9"> =></span></span>
<span class="line"><span style="color: #C9D1D9">      _selectedObjects.</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">((i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _objects[i]).</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">isObjectSelected</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _selectedObjects.</span><span style="color: #D2A8FF">contains</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called every time a new input touches the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {</span></span>
<span class="line"><span style="color: #C9D1D9">    _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> pt </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (offsetVal </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> scale) </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> (offset);</span></span>
<span class="line"><span style="color: #C9D1D9">      _marquee </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectPoints</span><span style="color: #C9D1D9">(pt, pt);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/// Update Controller Instance</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when any of the inputs update position</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offsetVal, </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> globalVal) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_marquee </span><span style="color: #FF7B72">!=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Update New Widget Rect</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _pts </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _marquee;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pointerMap.values.first;</span></span>
<span class="line"><span style="color: #C9D1D9">      _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pointerMap.values.first;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> delta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (b </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> a) </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">      _pts.end </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pts.end </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> delta;</span></span>
<span class="line"><span style="color: #C9D1D9">      _marquee </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pts;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _rect </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromPoints</span><span style="color: #C9D1D9">(_pts.start, _pts.end);</span></span>
<span class="line"><span style="color: #C9D1D9">      _selectedObjects.</span><span style="color: #D2A8FF">clear</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> _objects.length; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_rect.</span><span style="color: #D2A8FF">overlaps</span><span style="color: #C9D1D9">(_objects[i].rect)) {</span></span>
<span class="line"><span style="color: #C9D1D9">          _selectedObjects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (touchCount </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Widget Move</span></span>
<span class="line"><span style="color: #C9D1D9">      _isMovingCanvasObject </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> a </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pointerMap.values.first;</span></span>
<span class="line"><span style="color: #C9D1D9">      _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> b </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _pointerMap.values.first;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_selectedObjects.isEmpty) </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> idx </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> _selectedObjects) {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> widget </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _objects[idx];</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> delta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (b </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> a) </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _newOffset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> widget.offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> delta;</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects[idx] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> widget.</span><span style="color: #D2A8FF">copyWith</span><span style="color: #C9D1D9">(dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _newOffset.dx, dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _newOffset.dy);</span></span>
<span class="line"><span style="color: #C9D1D9">      }</span></span>
<span class="line"><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (touchCount </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Scale and Rotate Update</span></span>
<span class="line"><span style="color: #C9D1D9">      _isMovingCanvasObject </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _rectA </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_getRectFromPoints</span><span style="color: #C9D1D9">(_pointerMap.values.</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">      _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _rectB </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_getRectFromPoints</span><span style="color: #C9D1D9">(_pointerMap.values.</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _delta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _rectB.center </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> _rectA.center;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _newOffset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> (_delta </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> scale);</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _newOffset;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> aDistance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (_rectA.topLeft </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> _rectA.bottomRight).distance;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> bDistance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (_rectB.topLeft </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> _rectB.bottomRight).distance;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> change </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (bDistance </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> aDistance);</span></span>
<span class="line"><span style="color: #C9D1D9">      scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> scale </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> change;</span></span>
<span class="line"><span style="color: #C9D1D9">    } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #8B949E">// Pan Update</span></span>
<span class="line"><span style="color: #C9D1D9">      _isMovingCanvasObject </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _rectA </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_getRectFromPoints</span><span style="color: #C9D1D9">(_pointerMap.values.</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">      _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _rectB </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_getRectFromPoints</span><span style="color: #C9D1D9">(_pointerMap.values.</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">());</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _delta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _rectB.center </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> _rectA.center;</span></span>
<span class="line"><span style="color: #C9D1D9">      offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offset </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> (_delta </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> scale);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    _pointerMap[pointer] </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsetVal;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/// Update Controller Instance</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Called when a input is removed from the screen</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> pointer) {</span></span>
<span class="line"><span style="color: #C9D1D9">    _pointerMap.</span><span style="color: #D2A8FF">remove</span><span style="color: #C9D1D9">(pointer);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (touchCount </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      _isMovingCanvasObject </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_marquee </span><span style="color: #FF7B72">!=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      _marquee </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">      _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #8B949E">/// Update Controller Instance</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">selectObject</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">int</span><span style="color: #C9D1D9"> i) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">_metaPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">          _selectedObjects.</span><span style="color: #D2A8FF">clear</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        _selectedObjects.</span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> item </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _objects.</span><span style="color: #D2A8FF">removeAt</span><span style="color: #C9D1D9">(i);</span></span>
<span class="line"><span style="color: #C9D1D9">        _objects.</span><span style="color: #D2A8FF">insert</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">, item);</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Checks if the shift key on the keyboard is pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">shiftPressed</span><span style="color: #C9D1D9"> => _shiftPressed;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> _shiftPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Checks if the meta key on the keyboard is pressed</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">metaPressed</span><span style="color: #C9D1D9"> => _metaPressed;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">bool</span><span style="color: #C9D1D9"> _metaPressed </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Scale of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9"> => _scale;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">scale</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (value </span><span style="color: #FF7B72">&#x3C;=</span><span style="color: #C9D1D9"> minScale) {</span></span>
<span class="line"><span style="color: #C9D1D9">          value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> minScale;</span></span>
<span class="line"><span style="color: #C9D1D9">        } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (value </span><span style="color: #FF7B72">>=</span><span style="color: #C9D1D9"> maxScale) {</span></span>
<span class="line"><span style="color: #C9D1D9">          value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> maxScale;</span></span>
<span class="line"><span style="color: #C9D1D9">        }</span></span>
<span class="line"><span style="color: #C9D1D9">        _scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Max possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> maxScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">3.0</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Min possible scale</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> minScale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.2</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// How much to scale the canvas in increments</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scaleAdjust </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0.05</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// How much to shift the canvas in increments</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> offsetAdjust </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">15</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Current offset of the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9"> => _offset;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">set</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">offset</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> value) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(() {</span></span>
<span class="line"><span style="color: #C9D1D9">        _offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> _scaleDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">1</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">static</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> _offsetDefault </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">.zero;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Reset the canvas zoom and offset</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">reset</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _scaleDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">    offset </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _offsetDefault;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Zoom in the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomIn</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">+=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #8B949E">/// Zoom out the canvas</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">zoomOut</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    scale </span><span style="color: #FF7B72">-=</span><span style="color: #C9D1D9"> scaleAdjust;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_update</span><span style="color: #C9D1D9">(</span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Function</span><span style="color: #C9D1D9">() action) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">action</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">add</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_getRectFromPoints</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9">> offsets) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (offsets.length </span><span style="color: #FF7B72">==</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">2</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromPoints</span><span style="color: #C9D1D9">(offsets.first, offsets.last);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> dxs </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsets.</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">((e) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> e.dx).</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> dys </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> offsets.</span><span style="color: #D2A8FF">map</span><span style="color: #C9D1D9">((e) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> e.dy).</span><span style="color: #D2A8FF">toList</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> left </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_minFromList</span><span style="color: #C9D1D9">(dxs);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> top </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_minFromList</span><span style="color: #C9D1D9">(dys);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> bottom </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_maxFromList</span><span style="color: #C9D1D9">(dys);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> right </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_maxFromList</span><span style="color: #C9D1D9">(dxs);</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromLTRB</span><span style="color: #C9D1D9">(left, top, right, bottom);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_minFromList</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9">> values) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9">.infinity;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> item </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> values) {</span></span>
<span class="line"><span style="color: #C9D1D9">      value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> math.</span><span style="color: #D2A8FF">min</span><span style="color: #C9D1D9">(item, value);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_maxFromList</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">List</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9">> values) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">-</span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9">.infinity;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> item </span><span style="color: #FF7B72">in</span><span style="color: #C9D1D9"> values) {</span></span>
<span class="line"><span style="color: #C9D1D9">      value </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> math.</span><span style="color: #D2A8FF">max</span><span style="color: #C9D1D9">(item, value);</span></span>
<span class="line"><span style="color: #C9D1D9">    }</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> value;</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Add a new file <code>src/classes/rect_points.dart</code> and add the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'dart:ui'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectPoints</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">RectPoints</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.start, </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.end);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> start, end;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">get</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">rect</span><span style="color: #C9D1D9"> => </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromPoints</span><span style="color: #C9D1D9">(start, end);</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Update the <code>main.dart</code> with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'ui/home/screen.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">main</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">runApp</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">MyApp</span><span style="color: #C9D1D9">());</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MyApp</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatelessWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">MaterialApp</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      debugShowCheckedModeBanner</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      title</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Flutter Demo'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">      theme</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ThemeData</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        primarySwatch</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.blue,</span></span>
<span class="line"><span style="color: #C9D1D9">        accentColor</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red,</span></span>
<span class="line"><span style="color: #C9D1D9">        visualDensity</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">VisualDensity</span><span style="color: #C9D1D9">.adaptivePlatformDensity,</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">      darkTheme</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">ThemeData</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dark</span><span style="color: #C9D1D9">().</span><span style="color: #D2A8FF">copyWith</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        visualDensity</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">VisualDensity</span><span style="color: #C9D1D9">.adaptivePlatformDensity,</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">      home</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Update the home screen with the following:</p>
<pre is:raw="" class="astro-code" style="background-color: #0d1117; overflow-x: auto;"><code><span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/gestures.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'package:flutter/material.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/classes/canvas_object.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"><span style="color: #FF7B72">import</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'../../src/controllers/canvas.dart'</span><span style="color: #C9D1D9">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StatefulWidget</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">const</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">({</span><span style="color: #79C0FF">Key</span><span style="color: #C9D1D9"> key}) </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">(key</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> key);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">createState</span><span style="color: #C9D1D9">() </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">class</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">_HomeScreenState</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">extends</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">State</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">HomeScreen</span><span style="color: #C9D1D9">> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> _controller </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">();</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">init</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">initState</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">_dummyData</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">20</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.red),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">80</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">60</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">200</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.green),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">addObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">      </span><span style="color: #79C0FF">CanvasObject</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">        dx</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        dy</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">40</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        width</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">100</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        height</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">50</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">        child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.blue),</span></span>
<span class="line"><span style="color: #C9D1D9">      ),</span></span>
<span class="line"><span style="color: #C9D1D9">    );</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">void</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">() {</span></span>
<span class="line"><span style="color: #C9D1D9">    _controller.</span><span style="color: #D2A8FF">close</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #79C0FF">super</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">dispose</span><span style="color: #C9D1D9">();</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #FF7B72">@override</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Widget</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">build</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">BuildContext</span><span style="color: #C9D1D9"> context) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">StreamBuilder</span><span style="color: #C9D1D9">&#x3C;</span><span style="color: #79C0FF">CanvasController</span><span style="color: #C9D1D9">>(</span></span>
<span class="line"><span style="color: #C9D1D9">        stream</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.stream,</span></span>
<span class="line"><span style="color: #C9D1D9">        builder</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (context, snapshot) {</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">!</span><span style="color: #C9D1D9">snapshot.hasData) {</span></span>
<span class="line"><span style="color: #C9D1D9">            </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(),</span></span>
<span class="line"><span style="color: #C9D1D9">              body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Center</span><span style="color: #C9D1D9">(child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">CircularProgressIndicator</span><span style="color: #C9D1D9">()),</span></span>
<span class="line"><span style="color: #C9D1D9">            );</span></span>
<span class="line"><span style="color: #C9D1D9">          }</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> instance </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> snapshot.data;</span></span>
<span class="line"><span style="color: #C9D1D9">          </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Scaffold</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">            appBar</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">AppBar</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              actions</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Selection'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.select_all),</span></span>
<span class="line"><span style="color: #C9D1D9">                    color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.shiftPressed</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Theme</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">of</span><span style="color: #C9D1D9">(context).accentColor</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.shiftSelect,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Meta Key'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.metaPressed</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Theme</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">of</span><span style="color: #C9D1D9">(context).accentColor</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.category),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.metaSelect,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom In'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_in),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomIn,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Zoom Out'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.zoom_out),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.zoomOut,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #79C0FF">FocusScope</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  canRequestFocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">false</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">IconButton</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    tooltip</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #A5D6FF">'Reset the Scale and Offset'</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                    icon</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Icon</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Icons</span><span style="color: #C9D1D9">.restore),</span></span>
<span class="line"><span style="color: #C9D1D9">                    onPressed</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.reset,</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ],</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">            body</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Listener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">              behavior</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">HitTestBehavior</span><span style="color: #C9D1D9">.opaque,</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerSignal</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (details </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                  </span><span style="color: #79C0FF">GestureBinding</span><span style="color: #C9D1D9">.instance.pointerSignalResolver</span></span>
<span class="line"><span style="color: #C9D1D9">                      .</span><span style="color: #D2A8FF">register</span><span style="color: #C9D1D9">(details, (event) {</span></span>
<span class="line"><span style="color: #C9D1D9">                    </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (event </span><span style="color: #FF7B72">is</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">PointerScrollEvent</span><span style="color: #C9D1D9">) {</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (_controller.shiftPressed) {</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> zoomDelta </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9">event.scrollDelta.dy </span><span style="color: #FF7B72">/</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">300</span><span style="color: #C9D1D9">);</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.scale </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> _controller.scale </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> zoomDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      } </span><span style="color: #FF7B72">else</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">                        _controller.offset </span><span style="color: #FF7B72">=</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset </span><span style="color: #FF7B72">-</span><span style="color: #C9D1D9"> event.scrollDelta;</span></span>
<span class="line"><span style="color: #C9D1D9">                      }</span></span>
<span class="line"><span style="color: #C9D1D9">                    }</span></span>
<span class="line"><span style="color: #C9D1D9">                  });</span></span>
<span class="line"><span style="color: #C9D1D9">                }</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerMove</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">updateTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">addTouch</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.pointer,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.localPosition,</span></span>
<span class="line"><span style="color: #C9D1D9">                  details.position,</span></span>
<span class="line"><span style="color: #C9D1D9">                );</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerUp</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              onPointerCancel</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (details) {</span></span>
<span class="line"><span style="color: #C9D1D9">                _controller.</span><span style="color: #D2A8FF">removeTouch</span><span style="color: #C9D1D9">(details.pointer);</span></span>
<span class="line"><span style="color: #C9D1D9">              },</span></span>
<span class="line"><span style="color: #C9D1D9">              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RawKeyboardListener</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                autofocus</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">true</span><span style="color: #C9D1D9">,</span></span>
<span class="line"><span style="color: #C9D1D9">                focusNode</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> _controller.focusNode,</span></span>
<span class="line"><span style="color: #C9D1D9">                onKey</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (key) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">rawKeyEvent</span><span style="color: #C9D1D9">(context, key),</span></span>
<span class="line"><span style="color: #C9D1D9">                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">expand</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Stack</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                    children</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> [</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">for</span><span style="color: #C9D1D9"> (</span><span style="color: #FF7B72">var</span><span style="color: #C9D1D9"> i </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">0</span><span style="color: #C9D1D9">; i </span><span style="color: #FF7B72">&#x3C;</span><span style="color: #C9D1D9"> instance.objects.length; i</span><span style="color: #FF7B72">++</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">Positioned</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromRect</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                          rect</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.objects[i].rect.</span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.offset,</span></span>
<span class="line"><span style="color: #C9D1D9">                            _controller.scale,</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            decoration</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">BoxDecoration</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                                border</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Border</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">all</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                              color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.</span><span style="color: #D2A8FF">isObjectSelected</span><span style="color: #C9D1D9">(i)</span></span>
<span class="line"><span style="color: #C9D1D9">                                  </span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.grey</span></span>
<span class="line"><span style="color: #C9D1D9">                                  </span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.transparent,</span></span>
<span class="line"><span style="color: #C9D1D9">                            )),</span></span>
<span class="line"><span style="color: #C9D1D9">                            child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">GestureDetector</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                              onTapDown</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> (_) </span><span style="color: #FF7B72">=></span><span style="color: #C9D1D9"> _controller.</span><span style="color: #D2A8FF">selectObject</span><span style="color: #C9D1D9">(i),</span></span>
<span class="line"><span style="color: #C9D1D9">                              child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">FittedBox</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                                fit</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">BoxFit</span><span style="color: #C9D1D9">.fill,</span></span>
<span class="line"><span style="color: #C9D1D9">                                child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">SizedBox</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromSize</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                                  size</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.objects[i].size,</span></span>
<span class="line"><span style="color: #C9D1D9">                                  child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.objects[i].child,</span></span>
<span class="line"><span style="color: #C9D1D9">                                ),</span></span>
<span class="line"><span style="color: #C9D1D9">                              ),</span></span>
<span class="line"><span style="color: #C9D1D9">                            ),</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                        ),</span></span>
<span class="line"><span style="color: #C9D1D9">                      </span><span style="color: #FF7B72">if</span><span style="color: #C9D1D9"> (instance</span><span style="color: #FF7B72">?</span><span style="color: #C9D1D9">.marquee </span><span style="color: #FF7B72">!=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">null</span><span style="color: #C9D1D9">)</span></span>
<span class="line"><span style="color: #C9D1D9">                        </span><span style="color: #79C0FF">Positioned</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromRect</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                          rect</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> instance.marquee.rect</span></span>
<span class="line"><span style="color: #C9D1D9">                              .</span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(instance.offset, instance.scale),</span></span>
<span class="line"><span style="color: #C9D1D9">                          child</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Container</span><span style="color: #C9D1D9">(</span></span>
<span class="line"><span style="color: #C9D1D9">                            color</span><span style="color: #FF7B72">:</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Colors</span><span style="color: #C9D1D9">.blueAccent.</span><span style="color: #D2A8FF">withOpacity</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">0.3</span><span style="color: #C9D1D9">),</span></span>
<span class="line"><span style="color: #C9D1D9">                          ),</span></span>
<span class="line"><span style="color: #C9D1D9">                        ),</span></span>
<span class="line"><span style="color: #C9D1D9">                    ],</span></span>
<span class="line"><span style="color: #C9D1D9">                  ),</span></span>
<span class="line"><span style="color: #C9D1D9">                ),</span></span>
<span class="line"><span style="color: #C9D1D9">              ),</span></span>
<span class="line"><span style="color: #C9D1D9">            ),</span></span>
<span class="line"><span style="color: #C9D1D9">          );</span></span>
<span class="line"><span style="color: #C9D1D9">        });</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF7B72">extension</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">RectUtils</span><span style="color: #C9D1D9"> </span><span style="color: #FF7B72">on</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> {</span></span>
<span class="line"><span style="color: #C9D1D9">  </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9"> </span><span style="color: #D2A8FF">adjusted</span><span style="color: #C9D1D9">(</span><span style="color: #79C0FF">Offset</span><span style="color: #C9D1D9"> offset, </span><span style="color: #79C0FF">double</span><span style="color: #C9D1D9"> scale) {</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> left </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.left </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dx) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> top </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> (</span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.top </span><span style="color: #FF7B72">+</span><span style="color: #C9D1D9"> offset.dy) </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> width </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.width </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">final</span><span style="color: #C9D1D9"> height </span><span style="color: #FF7B72">=</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">this</span><span style="color: #C9D1D9">.height </span><span style="color: #FF7B72">*</span><span style="color: #C9D1D9"> scale;</span></span>
<span class="line"><span style="color: #C9D1D9">    </span><span style="color: #FF7B72">return</span><span style="color: #C9D1D9"> </span><span style="color: #79C0FF">Rect</span><span style="color: #C9D1D9">.</span><span style="color: #D2A8FF">fromLTWH</span><span style="color: #C9D1D9">(left, top, width, height);</span></span>
<span class="line"><span style="color: #C9D1D9">  }</span></span>
<span class="line"><span style="color: #C9D1D9">}</span></span>
<span class="line"></span></code></pre>
<p>Now you can move any object on the canvas just by clicking and dragging. You can zoom with 2 fingers and pan with 2 or 3 fingers. If you hold down the shift key then you can use a marquee to select multiple and if you hold down the meta/command key then you can select multiple by tapping each.</p>
<h2 id="-9"><a aria-hidden="true" tabindex="-1" href="#-9"><span class="icon icon-link"></span></a>Conclusion</h2>
<p>If you are on a device without a keyboard you can tap the new icons to turn on the keyboard key actions. When the object is selected there is a grey border.</p>
<p>Now you can add any widget to the canvas and pan and zoom!</p>
    </article>
    <aside class="astro-BVZIHDZO">
      <nav class="astro-XVRFUPWN">
  <h2 class="astro-XVRFUPWN">Table of Contents</h2>
  <ul class="astro-XVRFUPWN">
    <li class="astro-XVRFUPWN">
          <a href="#" class="heading-depth-2 astro-XVRFUPWN">
            Multi Touch Goal
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-1" class="heading-depth-2 astro-XVRFUPWN">
            Part 1 - Project Setup
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-2" class="heading-depth-2 astro-XVRFUPWN">
            Part 2 - Boilerplate
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-3" class="heading-depth-2 astro-XVRFUPWN">
            Part 3 - Creating the Controller
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-4" class="heading-depth-2 astro-XVRFUPWN">
            Part 4 - Adding Canvas Objects
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-5" class="heading-depth-2 astro-XVRFUPWN">
            Part 5 - Capture the Input
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-6" class="heading-depth-2 astro-XVRFUPWN">
            Part 5 - Canvas Offset and Scale
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-7" class="heading-depth-2 astro-XVRFUPWN">
            Part 6 - Keyboard Shortcuts
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-8" class="heading-depth-2 astro-XVRFUPWN">
            Part 7 - Multi Touch Input
          </a>
        </li><li class="astro-XVRFUPWN">
          <a href="#-9" class="heading-depth-2 astro-XVRFUPWN">
            Conclusion
          </a>
        </li>
  </ul>
</nav>
    </aside>
  </main>
    </main>
    <footer class="astro-SZ7XMLTE">
  <div class="links astro-AUSHCPD5">
  <a class="social-icon astro-AUSHCPD5" href="https://github.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/github.svg" alt="github" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://twitter.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/twitter.svg" alt="twitter" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://facebook.com/rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/facebook.svg" alt="facebook" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://instagram.com/rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/instagram.svg" alt="instagram" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://youtube.com/rodydavis" target="_blank" rel="noopener">
            <img src="/social/youtube.svg" alt="youtube" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://tiktok.com/@rodydavisjr" target="_blank" rel="noopener">
            <img src="/social/tiktok.svg" alt="tiktok" class="astro-AUSHCPD5">
          </a><a class="social-icon astro-AUSHCPD5" href="https://linkedin.com/in/rodydavis" target="_blank" rel="noopener">
            <img src="/social/linkedin.svg" alt="linkedin" class="astro-AUSHCPD5">
          </a>
</div>

  <div class="copyright astro-SZ7XMLTE">
    &copy; 2023
    Rody Davis. All rights reserved.
  </div>
</footer>
  </body></html>