---
import BlogPost from '../../layouts/BlogPost.astro';

export async function getStaticPaths({rss}) {
 const allPosts = await Astro.fetchContent('../../data/blog/*.md');
  const sortedPosts = allPosts.sort((a, b) => {
    const aDate = new Date(a.date) as any;
    const bDate = new Date(b.date) as any;
    return bDate - aDate;
  });
  rss({
    title: "Rody's Blog",
    stylesheet: true,
    description: 'Rody Davis personal blog with all my apps, examples and crazy explorations.',
    customData: `<language>en-us</language>`,
    items: sortedPosts.map(p => {
      const slug = p.file.pathname.split('/').pop().split('.').shift();
      const source = p.content.source;
      // Generate description from the first paragraph of the post
      const description = source.split('\n').find(line => line.trim().length > 0);
      return {
        title: p.title,
        description,
        link: `https://rodydavis.com/posts/${slug}`,
        pubDate: p.date,
      };
    }),
    dest: "/feed/feed.xml",
  });
  // Return your paths
  return sortedPosts.map(p => {
    const slug = p.file.pathname.split('/').pop().split('.').shift();
    return { 
        params: { slug },
        props: { post: p, slug},
    };
  });
}

const props = Astro.props;
const {Content} = props.post;
---

<BlogPost  content={props.post}>
    <Content />
</BlogPost>